.wdfn3co{padding-top:var(--wdfn3co-0);}
.b17dedj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}
/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkQ6XFxKYXJvZFxcV2VWb3RlXFxXZWJBcHBcXHNyY1xcanNcXHJvdXRlc1xcQmFsbG90XFxCYWxsb3QuanN4Il0sIm5hbWVzIjpbIi53ZGZuM2NvIiwiLmIxN2RlZGoiXSwibWFwcGluZ3MiOiJBQStrQ01BO0FBS0FDIiwiZmlsZSI6IkQ6XFxKYXJvZFxcV2VWb3RlXFxXZWJBcHBcXHNyY1xcanNcXHJvdXRlc1xcQmFsbG90XFxCYWxsb3QuanN4Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgSGVsbWV0IGZyb20gJ3JlYWN0LWhlbG1ldCc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyBzdHlsZWQgfSBmcm9tICdsaW5hcmlhL3JlYWN0JztcbmltcG9ydCBCYWRnZSBmcm9tICdAbWF0ZXJpYWwtdWkvY29yZS9CYWRnZSc7XG5pbXBvcnQgQ2hpcCBmcm9tICdAbWF0ZXJpYWwtdWkvY29yZS9DaGlwJztcbmltcG9ydCBMaW5rIGZyb20gJ0BtYXRlcmlhbC11aS9jb3JlL0xpbmsnO1xuaW1wb3J0IHsgd2l0aFN0eWxlcyB9IGZyb20gJ0BtYXRlcmlhbC11aS9jb3JlL3N0eWxlcyc7XG5pbXBvcnQgQWRkcmVzc0JveCBmcm9tICcuLi8uLi9jb21wb25lbnRzL0FkZHJlc3NCb3gnO1xuaW1wb3J0IEFuYWx5dGljc0FjdGlvbnMgZnJvbSAnLi4vLi4vYWN0aW9ucy9BbmFseXRpY3NBY3Rpb25zJztcbmltcG9ydCBCYWxsb3RBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvQmFsbG90QWN0aW9ucyc7XG5pbXBvcnQgQmFsbG90RWxlY3Rpb25MaXN0V2l0aEZpbHRlcnMgZnJvbSAnLi4vLi4vY29tcG9uZW50cy9CYWxsb3QvQmFsbG90RWxlY3Rpb25MaXN0V2l0aEZpbHRlcnMnO1xuaW1wb3J0IEJhbGxvdERlY2lzaW9uc1RhYnMgZnJvbSAnLi4vLi4vY29tcG9uZW50cy9OYXZpZ2F0aW9uL0JhbGxvdERlY2lzaW9uc1RhYnMnO1xuaW1wb3J0IEJhbGxvdEl0ZW1Db21wcmVzc2VkIGZyb20gJy4uLy4uL2NvbXBvbmVudHMvQmFsbG90L0JhbGxvdEl0ZW1Db21wcmVzc2VkJztcbmltcG9ydCBCYWxsb3RUaXRsZUhlYWRlciBmcm9tICcuL0JhbGxvdFRpdGxlSGVhZGVyJztcbmltcG9ydCBCYWxsb3RTaWRlQmFyIGZyb20gJy4uLy4uL2NvbXBvbmVudHMvTmF2aWdhdGlvbi9CYWxsb3RTaWRlQmFyJztcbmltcG9ydCBCYWxsb3RTZWFyY2ggZnJvbSAnLi4vLi4vY29tcG9uZW50cy9CYWxsb3QvQmFsbG90U2VhcmNoJztcbmltcG9ydCBCYWxsb3RTdGF0dXNNZXNzYWdlIGZyb20gJy4uLy4uL2NvbXBvbmVudHMvQmFsbG90L0JhbGxvdFN0YXR1c01lc3NhZ2UnO1xuaW1wb3J0IEJhbGxvdFN0b3JlIGZyb20gJy4uLy4uL3N0b3Jlcy9CYWxsb3RTdG9yZSc7XG5pbXBvcnQgQnJvd3NlclB1c2hNZXNzYWdlIGZyb20gJy4uLy4uL2NvbXBvbmVudHMvV2lkZ2V0cy9Ccm93c2VyUHVzaE1lc3NhZ2UnO1xuaW1wb3J0IGNvb2tpZXMgZnJvbSAnLi4vLi4vdXRpbHMvY29va2llcyc7XG5pbXBvcnQgeyBjb3Jkb3ZhQmFsbG90RmlsdGVyVG9wTWFyZ2luLCBjb3Jkb3ZhU2Nyb2xsYWJsZVBhbmVUb3BQYWRkaW5nIH0gZnJvbSAnLi4vLi4vdXRpbHMvY29yZG92YU9mZnNldHMnO1xuaW1wb3J0IHsgaGlzdG9yeVB1c2gsIGlzQ29yZG92YSwgaXNXZWJBcHAgfSBmcm9tICcuLi8uLi91dGlscy9jb3Jkb3ZhVXRpbHMnO1xuaW1wb3J0IEVsZWN0aW9uQWN0aW9ucyBmcm9tICcuLi8uLi9hY3Rpb25zL0VsZWN0aW9uQWN0aW9ucyc7XG5pbXBvcnQgRWxlY3Rpb25TdG9yZSBmcm9tICcuLi8uLi9zdG9yZXMvRWxlY3Rpb25TdG9yZSc7XG5pbXBvcnQgaXNNb2JpbGUgZnJvbSAnLi4vLi4vdXRpbHMvaXNNb2JpbGUnO1xuaW1wb3J0IExvY2F0aW9uR3Vlc3MgZnJvbSAnLi4vLi4vY29tcG9uZW50cy9CYWxsb3QvTG9jYXRpb25HdWVzcyc7XG5pbXBvcnQgbWFwQ2F0ZWdvcnlGaWx0ZXJUeXBlIGZyb20gJy4uLy4uL3V0aWxzL21hcC1jYXRlZ29yeS1maWx0ZXItdHlwZSc7XG5pbXBvcnQgSXNzdWVBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvSXNzdWVBY3Rpb25zJztcbmltcG9ydCBJc3N1ZVN0b3JlIGZyb20gJy4uLy4uL3N0b3Jlcy9Jc3N1ZVN0b3JlJztcbmltcG9ydCBPcGVuRXh0ZXJuYWxXZWJTaXRlIGZyb20gJy4uLy4uL2NvbXBvbmVudHMvV2lkZ2V0cy9PcGVuRXh0ZXJuYWxXZWJTaXRlJztcbmltcG9ydCBPcmdhbml6YXRpb25BY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvT3JnYW5pemF0aW9uQWN0aW9ucyc7XG5pbXBvcnQgeyByZW5kZXJMb2cgfSBmcm9tICcuLi8uLi91dGlscy9sb2dnaW5nJztcbmltcG9ydCBTdXBwb3J0QWN0aW9ucyBmcm9tICcuLi8uLi9hY3Rpb25zL1N1cHBvcnRBY3Rpb25zJztcbmltcG9ydCBTdXBwb3J0U3RvcmUgZnJvbSAnLi4vLi4vc3RvcmVzL1N1cHBvcnRTdG9yZSc7XG5pbXBvcnQgVm90ZXJBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvVm90ZXJBY3Rpb25zJztcbmltcG9ydCBWb3Rlckd1aWRlU3RvcmUgZnJvbSAnLi4vLi4vc3RvcmVzL1ZvdGVyR3VpZGVTdG9yZSc7XG5pbXBvcnQgQXBwU3RvcmUgZnJvbSAnLi4vLi4vc3RvcmVzL0FwcFN0b3JlJztcbmltcG9ydCBWb3RlclN0b3JlIGZyb20gJy4uLy4uL3N0b3Jlcy9Wb3RlclN0b3JlJztcbmltcG9ydCB3ZWJBcHBDb25maWcgZnJvbSAnLi4vLi4vY29uZmlnJztcbmltcG9ydCB7IGZvcm1hdFZvdGVyQmFsbG90TGlzdCwgY2hlY2tTaG91bGRVcGRhdGUgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBBcHBBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvQXBwQWN0aW9ucyc7XG5pbXBvcnQgQmFsbG90U3VtbWFyeUZvb3RlciBmcm9tICcuLi8uLi9jb21wb25lbnRzL05hdmlnYXRpb24vQmFsbG90U3VtbWFyeUZvb3Rlcic7XG5cbmNvbnN0IFRZUEVTID0gcmVxdWlyZSgna2V5bWlycm9yJykoe1xuICBPRkZJQ0U6IG51bGwsXG4gIE1FQVNVUkU6IG51bGwsXG59KTtcblxuLy8gUmVsYXRlZCB0byBXZWJBcHAvc3JjL2pzL2NvbXBvbmVudHMvVm90ZXJHdWlkZS9Wb3Rlckd1aWRlQmFsbG90LmpzeFxuY29uc3QgQkFMTE9UX0lURU1fRklMVEVSX1RZUEVTID0gWydGZWRlcmFsJywgJ1N0YXRlJywgJ01lYXN1cmUnLCAnTG9jYWwnXTtcbmNvbnN0IGRlbGF5QmVmb3JlVm90ZXJSZWZyZXNoQ2FsbCA9IDEwMDA7XG5cbmNsYXNzIEJhbGxvdCBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgbG9jYXRpb246IFByb3BUeXBlcy5vYmplY3QsXG4gICAgcGF0aG5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgcGFyYW1zOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGNsYXNzZXM6IFByb3BUeXBlcy5vYmplY3QsXG4gIH07XG5cbiAgY29uc3RydWN0b3IgKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBiYWxsb3RFbGVjdGlvbkxpc3Q6IFtdLFxuICAgICAgYmFsbG90SXRlbVVuZnVybGVkVHJhY2tlcjoge30sXG4gICAgICBiYWxsb3RMZW5ndGg6IDAsXG4gICAgICBiYWxsb3RSZW1haW5pbmdDaG9pY2VzTGVuZ3RoOiAwLFxuICAgICAgYmFsbG90V2l0aEFsbEl0ZW1zOiBbXSxcbiAgICAgIGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZTogW10sXG4gICAgICBmb3VuZEZpcnN0UmFjZUxldmVsOiBmYWxzZSxcbiAgICAgIHJhY2VMZXZlbEZpbHRlclR5cGU6ICcnLFxuICAgICAgYmFsbG90UmV0dXJuZWRXZVZvdGVJZDogJycsXG4gICAgICBiYWxsb3RMb2NhdGlvblNob3J0Y3V0OiAnJyxcbiAgICAgIGNhbmRpZGF0ZUZvck1vZGFsOiB7XG4gICAgICAgIHZvdGVyX2d1aWRlc190b19mb2xsb3dfZm9yX2xhdGVzdF9iYWxsb3RfaXRlbTogW10sXG4gICAgICAgIHBvc2l0aW9uX2xpc3Q6IFtdLFxuICAgICAgfSxcbiAgICAgIGNvbXBvbmVudERpZE1vdW50RmluaXNoZWQ6IGZhbHNlLFxuICAgICAgbGFzdEhhc2hVc2VkSW5MaW5rU2Nyb2xsOiAnJyxcbiAgICAgIG1lYXN1cmVGb3JNb2RhbDoge1xuICAgICAgICB2b3Rlcl9ndWlkZXNfdG9fZm9sbG93X2Zvcl9sYXRlc3RfYmFsbG90X2l0ZW06IFtdLFxuICAgICAgICBwb3NpdGlvbl9saXN0OiBbXSxcbiAgICAgIH0sXG4gICAgICBtZW1iZXJWaWV3ZWRCYWxsb3RIYXNCZWVuU2F2ZWRPbmNlOiB7fSxcbiAgICAgIG1vdW50ZWQ6IGZhbHNlLFxuICAgICAgbnVtYmVyT2ZWb3RlclJldHJpZXZlQXR0ZW1wdHM6IDAsXG4gICAgICBzaG93U2VsZWN0QmFsbG90TW9kYWw6IGZhbHNlLFxuICAgICAgdm90ZXJCYWxsb3RMaXN0OiBbXSxcbiAgICAgIHNob3dGaWx0ZXJUYWJzOiBmYWxzZSxcbiAgICAgIGJhbGxvdEhlYWRlclVucGlubmVkOiBmYWxzZSxcbiAgICAgIGlzU2VhcmNoaW5nOiBmYWxzZSxcbiAgICAgIGJhbGxvdFNlYXJjaFJlc3VsdHM6IFtdLFxuICAgICAgcmFjZUxldmVsRmlsdGVySXRlbXNJblRoaXNCYWxsb3Q6IHVuZGVmaW5lZCxcbiAgICB9O1xuXG4gICAgdGhpcy5iYWxsb3RJdGVtcyA9IHt9O1xuICAgIHRoaXMuYmFsbG90SXRlbUxpbmtIYXNCZWVuQ2xpY2tlZCA9IHRoaXMuYmFsbG90SXRlbUxpbmtIYXNCZWVuQ2xpY2tlZC5iaW5kKHRoaXMpO1xuICAgIHRoaXMudG9nZ2xlU2VsZWN0QmFsbG90TW9kYWwgPSB0aGlzLnRvZ2dsZVNlbGVjdEJhbGxvdE1vZGFsLmJpbmQodGhpcyk7XG4gICAgdGhpcy51cGRhdGVPZmZpY2VEaXNwbGF5VW5mdXJsZWRUcmFja2VyID0gdGhpcy51cGRhdGVPZmZpY2VEaXNwbGF5VW5mdXJsZWRUcmFja2VyLmJpbmQodGhpcyk7XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCAoKSB7XG4gICAgY29uc3QgYmFsbG90QmFzZVVybCA9ICcvYmFsbG90JztcbiAgICB0aGlzLmFwcFN0b3JlTGlzdGVuZXIgPSBBcHBTdG9yZS5hZGRMaXN0ZW5lcih0aGlzLm9uQXBwU3RvcmVDaGFuZ2UuYmluZCh0aGlzKSk7XG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGNvbXBvbmVudERpZE1vdW50RmluaXNoZWQ6IHRydWUsXG4gICAgICBtb3VudGVkOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY29tcGxldGlvbkxldmVsRmlsdGVyVHlwZSA9IEJhbGxvdFN0b3JlLmdldENvbXBsZXRpb25MZXZlbEZpbHRlclR5cGVTYXZlZCgpIHx8ICdhbGwnO1xuICAgIGNvbnN0IGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZSA9IEJhbGxvdFN0b3JlLmdldEJhbGxvdEJ5Q29tcGxldGlvbkxldmVsRmlsdGVyVHlwZShjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlKTtcbiAgICBpZiAoYmFsbG90V2l0aEl0ZW1zRnJvbUNvbXBsZXRpb25GaWx0ZXJUeXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdiYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGUgIT09IHVuZGVmaW5lZCcpO1xuICAgICAgaWYgKGNvbXBsZXRpb25MZXZlbEZpbHRlclR5cGUgPT09ICdhbGwnKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIGJhbGxvdFdpdGhBbGxJdGVtczogYmFsbG90V2l0aEl0ZW1zRnJvbUNvbXBsZXRpb25GaWx0ZXJUeXBlLFxuICAgICAgICAgIGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBiYWxsb3RXaXRoQWxsSXRlbXMgPSBCYWxsb3RTdG9yZS5nZXRCYWxsb3RCeUNvbXBsZXRpb25MZXZlbEZpbHRlclR5cGUoJ2FsbCcpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBiYWxsb3RXaXRoQWxsSXRlbXMsXG4gICAgICAgICAgYmFsbG90V2l0aEl0ZW1zRnJvbUNvbXBsZXRpb25GaWx0ZXJUeXBlLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkRnJvbVVybCA9IHRoaXMucHJvcHMucGFyYW1zLmdvb2dsZV9jaXZpY19lbGVjdGlvbl9pZCB8fCAwO1xuXG4gICAgLy8gY29uc29sZS5sb2coJ2dvb2dsZUNpdmljRWxlY3Rpb25JZEZyb21Vcmw6ICcsIGdvb2dsZUNpdmljRWxlY3Rpb25JZEZyb21VcmwpO1xuICAgIGxldCBiYWxsb3RSZXR1cm5lZFdlVm90ZUlkID0gdGhpcy5wcm9wcy5wYXJhbXMuYmFsbG90X3JldHVybmVkX3dlX3ZvdGVfaWQgfHwgJyc7XG4gICAgYmFsbG90UmV0dXJuZWRXZVZvdGVJZCA9IGJhbGxvdFJldHVybmVkV2VWb3RlSWQgPT09ICdub25lJyA/ICcnIDogYmFsbG90UmV0dXJuZWRXZVZvdGVJZDtcblxuICAgIC8vIGNvbnNvbGUubG9nKCd0aGlzLnByb3BzLnBhcmFtcy5iYWxsb3RfcmV0dXJuZWRfd2Vfdm90ZV9pZDogJywgdGhpcy5wcm9wcy5wYXJhbXMuYmFsbG90X3JldHVybmVkX3dlX3ZvdGVfaWQpO1xuICAgIGxldCBiYWxsb3RMb2NhdGlvblNob3J0Y3V0ID0gdGhpcy5wcm9wcy5wYXJhbXMuYmFsbG90X2xvY2F0aW9uX3Nob3J0Y3V0IHx8ICcnO1xuICAgIGJhbGxvdExvY2F0aW9uU2hvcnRjdXQgPSBiYWxsb3RMb2NhdGlvblNob3J0Y3V0LnRyaW0oKTtcbiAgICBiYWxsb3RMb2NhdGlvblNob3J0Y3V0ID0gYmFsbG90TG9jYXRpb25TaG9ydGN1dCA9PT0gJ25vbmUnID8gJycgOiBiYWxsb3RMb2NhdGlvblNob3J0Y3V0O1xuICAgIGxldCBnb29nbGVDaXZpY0VsZWN0aW9uSWQgPSAwO1xuXG4gICAgLy8gY29uc29sZS5sb2coJ2NvbXBvbmVudERpZE1vdW50LCBCYWxsb3RTdG9yZS5iYWxsb3RQcm9wZXJ0aWVzOiAnLCBCYWxsb3RTdG9yZS5iYWxsb3RQcm9wZXJ0aWVzKTtcbiAgICBpZiAoZ29vZ2xlQ2l2aWNFbGVjdGlvbklkRnJvbVVybCAhPT0gMCkge1xuICAgICAgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkRnJvbVVybCA9IHBhcnNlSW50KGdvb2dsZUNpdmljRWxlY3Rpb25JZEZyb21VcmwsIDEwKTtcblxuICAgICAgLy8gZ29vZ2xlQ2l2aWNFbGVjdGlvbklkID0gZ29vZ2xlQ2l2aWNFbGVjdGlvbklkRnJvbVVybDtcbiAgICB9IGVsc2UgaWYgKEJhbGxvdFN0b3JlLmJhbGxvdFByb3BlcnRpZXMgJiYgQmFsbG90U3RvcmUuYmFsbG90UHJvcGVydGllcy5nb29nbGVfY2l2aWNfZWxlY3Rpb25faWQpIHtcbiAgICAgIGdvb2dsZUNpdmljRWxlY3Rpb25JZCA9IEJhbGxvdFN0b3JlLmJhbGxvdFByb3BlcnRpZXMuZ29vZ2xlX2NpdmljX2VsZWN0aW9uX2lkO1xuICAgIH1cblxuICAgIC8vIGNvbnNvbGUubG9nKCdiYWxsb3RSZXR1cm5lZFdlVm90ZUlkOiAnLCBiYWxsb3RSZXR1cm5lZFdlVm90ZUlkLCAnLCBiYWxsb3RMb2NhdGlvblNob3J0Y3V0OicsIGJhbGxvdExvY2F0aW9uU2hvcnRjdXQsICcsIGdvb2dsZUNpdmljRWxlY3Rpb25JZEZyb21Vcmw6ICcsIGdvb2dsZUNpdmljRWxlY3Rpb25JZEZyb21VcmwpO1xuICAgIGlmIChiYWxsb3RSZXR1cm5lZFdlVm90ZUlkIHx8IGJhbGxvdExvY2F0aW9uU2hvcnRjdXQgfHwgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkRnJvbVVybCkge1xuICAgICAgaWYgKGJhbGxvdExvY2F0aW9uU2hvcnRjdXQgIT09ICcnKSB7XG4gICAgICAgIC8vIENoYW5nZSB0aGUgYmFsbG90IG9uIGxvYWQgdG8gbWFrZSBzdXJlIHdlIGFyZSBnZXR0aW5nIHdoYXQgd2UgZXhwZWN0IGZyb20gdGhlIHVybFxuICAgICAgICBCYWxsb3RBY3Rpb25zLnZvdGVyQmFsbG90SXRlbXNSZXRyaWV2ZSgwLCAnJywgYmFsbG90TG9jYXRpb25TaG9ydGN1dCk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIHRoZSBVUkwgdG8gbWF0Y2hcbiAgICAgICAgaGlzdG9yeVB1c2goYCR7YmFsbG90QmFzZVVybH0vJHtiYWxsb3RMb2NhdGlvblNob3J0Y3V0fWApO1xuICAgICAgfSBlbHNlIGlmIChiYWxsb3RSZXR1cm5lZFdlVm90ZUlkICE9PSAnJykge1xuICAgICAgICAvLyBDaGFuZ2UgdGhlIGJhbGxvdCBvbiBsb2FkIHRvIG1ha2Ugc3VyZSB3ZSBhcmUgZ2V0dGluZyB3aGF0IHdlIGV4cGVjdCBmcm9tIHRoZSB1cmxcbiAgICAgICAgQmFsbG90QWN0aW9ucy52b3RlckJhbGxvdEl0ZW1zUmV0cmlldmUoMCwgYmFsbG90UmV0dXJuZWRXZVZvdGVJZCwgJycpO1xuXG4gICAgICAgIC8vIENoYW5nZSB0aGUgVVJMIHRvIG1hdGNoXG4gICAgICAgIGhpc3RvcnlQdXNoKGAke2JhbGxvdEJhc2VVcmx9L2lkLyR7YmFsbG90UmV0dXJuZWRXZVZvdGVJZH1gKTtcbiAgICAgIH0gZWxzZSBpZiAoZ29vZ2xlQ2l2aWNFbGVjdGlvbklkRnJvbVVybCAhPT0gMCkge1xuICAgICAgICAvLyBDaGFuZ2UgdGhlIGJhbGxvdCBvbiBsb2FkIHRvIG1ha2Ugc3VyZSB3ZSBhcmUgZ2V0dGluZyB3aGF0IHdlIGV4cGVjdCBmcm9tIHRoZSB1cmxcbiAgICAgICAgaWYgKGdvb2dsZUNpdmljRWxlY3Rpb25JZCAhPT0gZ29vZ2xlQ2l2aWNFbGVjdGlvbklkRnJvbVVybCkge1xuICAgICAgICAgIEJhbGxvdEFjdGlvbnMudm90ZXJCYWxsb3RJdGVtc1JldHJpZXZlKGdvb2dsZUNpdmljRWxlY3Rpb25JZEZyb21VcmwsICcnLCAnJyk7XG5cbiAgICAgICAgICAvLyBDaGFuZ2UgdGhlIFVSTCB0byBtYXRjaFxuICAgICAgICAgIGNvbnN0IGJhbGxvdEVsZWN0aW9uVXJsID0gYCR7YmFsbG90QmFzZVVybH0vZWxlY3Rpb24vJHtnb29nbGVDaXZpY0VsZWN0aW9uSWRGcm9tVXJsfWA7XG4gICAgICAgICAgaGlzdG9yeVB1c2goYmFsbG90RWxlY3Rpb25VcmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTm8gY2hhbmdlIHRvIHRoZSBVUkwgbmVlZGVkXG4gICAgICAgIC8vIE5vdyBzZXQgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkXG4gICAgICAgIGdvb2dsZUNpdmljRWxlY3Rpb25JZCA9IGdvb2dsZUNpdmljRWxlY3Rpb25JZEZyb21Vcmw7XG4gICAgICB9IGVsc2UgaWYgKGdvb2dsZUNpdmljRWxlY3Rpb25JZCAhPT0gMCkge1xuICAgICAgICAvLyBObyBuZWVkIHRvIHJldHJpZXZlIGRhdGEgYWdhaW5cbiAgICAgICAgLy8gQ2hhbmdlIHRoZSBVUkwgdG8gbWF0Y2ggdGhlIGN1cnJlbnQgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkXG4gICAgICAgIGNvbnN0IGJhbGxvdEVsZWN0aW9uVXJsMiA9IGAke2JhbGxvdEJhc2VVcmx9L2VsZWN0aW9uLyR7Z29vZ2xlQ2l2aWNFbGVjdGlvbklkfWA7XG4gICAgICAgIGhpc3RvcnlQdXNoKGJhbGxvdEVsZWN0aW9uVXJsMik7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChCYWxsb3RTdG9yZS5iYWxsb3RQcm9wZXJ0aWVzICYmIEJhbGxvdFN0b3JlLmJhbGxvdFByb3BlcnRpZXMuYmFsbG90X2ZvdW5kID09PSBmYWxzZSkgeyAvLyBObyBiYWxsb3QgZm91bmRcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdpZiAoQmFsbG90U3RvcmUuYmFsbG90UHJvcGVydGllcyAmJiBCYWxsb3RTdG9yZS5iYWxsb3RQcm9wZXJ0aWVzLmJhbGxvdF9mb3VuZCA9PT0gZmFsc2UnKTtcbiAgICAgIGhpc3RvcnlQdXNoKCcvc2V0dGluZ3MvbG9jYXRpb24nKTtcbiAgICB9IGVsc2UgaWYgKGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnV2ViQXBwIGRvZXNuJ3Qga25vdyB0aGUgZWxlY3Rpb24gb3IgaGF2ZSBiYWxsb3QgZGF0YSwgc28gYXNrIHRoZSBBUEkgc2VydmVyIHRvIHJldHVybiBiZXN0IGd1ZXNzJyk7XG4gICAgICBCYWxsb3RBY3Rpb25zLnZvdGVyQmFsbG90SXRlbXNSZXRyaWV2ZSgwLCAnJywgJycpO1xuICAgIH1cblxuICAgIC8vIGNvbnNvbGUubG9nKCdCYWxsb3QsIGdvb2dsZUNpdmljRWxlY3Rpb25JZDogJywgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkLCAnLCBiYWxsb3RMb2NhdGlvblNob3J0Y3V0OiAnLCBiYWxsb3RMb2NhdGlvblNob3J0Y3V0LCAnYmFsbG90UmV0dXJuZWRXZVZvdGVJZDogJywgYmFsbG90UmV0dXJuZWRXZVZvdGVJZCk7XG4gICAgLy8gY29uc29sZS5sb2coJ1ZvdGVyU3RvcmUuZWxlY3Rpb25faWQ6ICcsIFZvdGVyU3RvcmUuZWxlY3Rpb25JZCgpKTtcbiAgICBpZiAoZ29vZ2xlQ2l2aWNFbGVjdGlvbklkIHx8IGJhbGxvdExvY2F0aW9uU2hvcnRjdXQgfHwgYmFsbG90UmV0dXJuZWRXZVZvdGVJZCkge1xuICAgICAgLy8gY29uc29sZS5sb2coJ0NBTExJTkcgSXNzdWVBY3Rpb25zLmlzc3Vlc1JldHJpZXZlRm9yRWxlY3Rpb24nKTtcblxuICAgICAgaWYgKElzc3VlU3RvcmUuZ2V0UHJldmlvdXNHb29nbGVDaXZpY0VsZWN0aW9uSWQoKSA8IDEpIHtcbiAgICAgICAgSXNzdWVBY3Rpb25zLmlzc3Vlc1JldHJpZXZlRm9yRWxlY3Rpb24oZ29vZ2xlQ2l2aWNFbGVjdGlvbklkLCBiYWxsb3RMb2NhdGlvblNob3J0Y3V0LCBiYWxsb3RSZXR1cm5lZFdlVm90ZUlkKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGlzc3Vlc1JldHJpZXZlZEZyb21Hb29nbGVDaXZpY0VsZWN0aW9uSWQ6IGdvb2dsZUNpdmljRWxlY3Rpb25JZCxcbiAgICAgICAgaXNzdWVzUmV0cmlldmVkRnJvbUJhbGxvdFJldHVybmVkV2VWb3RlSWQ6IGJhbGxvdFJldHVybmVkV2VWb3RlSWQsXG4gICAgICAgIGlzc3Vlc1JldHJpZXZlZEZyb21CYWxsb3RMb2NhdGlvblNob3J0Y3V0OiBiYWxsb3RMb2NhdGlvblNob3J0Y3V0LFxuICAgICAgfSk7XG4gICAgfVxuICAgIC8vIFdlIG5lZWQgYSBiYWxsb3RTdG9yZUxpc3RlbmVyIGhlcmUgYmVjYXVzZSB3ZSB3YW50IHRoZSBiYWxsb3QgdG8gZGlzcGxheSBiZWZvcmUgcG9zaXRpb25zIGFyZSByZWNlaXZlZFxuICAgIHRoaXMuYmFsbG90U3RvcmVMaXN0ZW5lciA9IEJhbGxvdFN0b3JlLmFkZExpc3RlbmVyKHRoaXMub25CYWxsb3RTdG9yZUNoYW5nZS5iaW5kKHRoaXMpKTtcbiAgICAvLyBOT1RFOiB2b3RlckFsbFBvc2l0aW9uc1JldHJpZXZlIGlzIGFsc28gY2FsbGVkIGluIFN1cHBvcnRTdG9yZSB3aGVuIHZvdGVyQWRkcmVzc1JldHJpZXZlIGlzIHJlY2VpdmVkLFxuICAgIC8vIHNvIHdlIGdldCBkdXBsaWNhdGUgY2FsbHMgd2hlbiB5b3UgY29tZSBzdHJhaWdodCB0byB0aGUgQmFsbG90IHBhZ2UuIFRoZXJlIGlzIG5vIGVhc3kgd2F5IGFyb3VuZCB0aGlzIGN1cnJlbnRseS5cbiAgICBTdXBwb3J0QWN0aW9ucy52b3RlckFsbFBvc2l0aW9uc1JldHJpZXZlKCk7XG5cbiAgICBCYWxsb3RBY3Rpb25zLnZvdGVyQmFsbG90TGlzdFJldHJpZXZlKCk7IC8vIFJldHJpZXZlIGEgbGlzdCBvZiBiYWxsb3RzIGZvciB0aGUgdm90ZXIgZnJvbSBvdGhlciBlbGVjdGlvbnNcbiAgICB0aGlzLnZvdGVyR3VpZGVTdG9yZUxpc3RlbmVyID0gVm90ZXJHdWlkZVN0b3JlLmFkZExpc3RlbmVyKHRoaXMub25Wb3Rlckd1aWRlU3RvcmVDaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5zdXBwb3J0U3RvcmVMaXN0ZW5lciA9IFN1cHBvcnRTdG9yZS5hZGRMaXN0ZW5lcih0aGlzLm9uQmFsbG90U3RvcmVDaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5vblZvdGVyU3RvcmVDaGFuZ2UoKTtcbiAgICB0aGlzLnZvdGVyU3RvcmVMaXN0ZW5lciA9IFZvdGVyU3RvcmUuYWRkTGlzdGVuZXIodGhpcy5vblZvdGVyU3RvcmVDaGFuZ2UuYmluZCh0aGlzKSk7XG5cbiAgICAvLyBPbmNlIGEgdm90ZXIgaGl0cyB0aGUgYmFsbG90LCB0aGV5IGhhdmUgZ29uZSB0aHJvdWdoIG9yaWVudGF0aW9uXG4gICAgY29va2llcy5zZXRJdGVtKCdiYWxsb3RfaGFzX2JlZW5fdmlzaXRlZCcsICcxJywgSW5maW5pdHksICcvJyk7XG5cbiAgICB0aGlzLmVsZWN0aW9uTGlzdExpc3RlbmVyID0gRWxlY3Rpb25TdG9yZS5hZGRMaXN0ZW5lcih0aGlzLm9uRWxlY3Rpb25TdG9yZUNoYW5nZS5iaW5kKHRoaXMpKTtcbiAgICBFbGVjdGlvbkFjdGlvbnMuZWxlY3Rpb25zUmV0cmlldmUoKTtcbiAgICBPcmdhbml6YXRpb25BY3Rpb25zLm9yZ2FuaXphdGlvbnNGb2xsb3dlZFJldHJpZXZlKCk7XG4gICAgVm90ZXJBY3Rpb25zLnZvdGVyUmV0cmlldmUoKTsgLy8gVGhpcyBpcyBuZWVkZWQgdG8gdXBkYXRlIHRoZSBpbnRlcmZhY2Ugc3RhdHVzIHNldHRpbmdzXG5cbiAgICBpZiAoZ29vZ2xlQ2l2aWNFbGVjdGlvbklkICYmIGdvb2dsZUNpdmljRWxlY3Rpb25JZCAhPT0gMCkge1xuICAgICAgQW5hbHl0aWNzQWN0aW9ucy5zYXZlQWN0aW9uQmFsbG90VmlzaXQoZ29vZ2xlQ2l2aWNFbGVjdGlvbklkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgQW5hbHl0aWNzQWN0aW9ucy5zYXZlQWN0aW9uQmFsbG90VmlzaXQoVm90ZXJTdG9yZS5lbGVjdGlvbklkKCkpO1xuICAgIH1cblxuICAgIGNvbnN0IHsgbG9jYXRpb24gfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBwYXRobmFtZSB9ID0gbG9jYXRpb247XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBiYWxsb3RFbGVjdGlvbkxpc3Q6IEJhbGxvdFN0b3JlLmJhbGxvdEVsZWN0aW9uTGlzdCgpLFxuICAgICAgY29tcGxldGlvbkxldmVsRmlsdGVyVHlwZSxcbiAgICAgIGJhbGxvdFJldHVybmVkV2VWb3RlSWQsXG4gICAgICBiYWxsb3RMb2NhdGlvblNob3J0Y3V0LFxuICAgICAgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkOiBwYXJzZUludChnb29nbGVDaXZpY0VsZWN0aW9uSWQsIDEwKSxcbiAgICAgIGxvY2F0aW9uLFxuICAgICAgcGF0aG5hbWUsXG4gICAgICByYWNlTGV2ZWxGaWx0ZXJUeXBlOiBCYWxsb3RTdG9yZS5nZXRSYWNlTGV2ZWxGaWx0ZXJUeXBlU2F2ZWQoKSB8fCAnRmVkZXJhbCcsXG4gICAgfSk7XG5cbiAgICBjb25zdCB7IGhhc2ggfSA9IGxvY2F0aW9uO1xuICAgIGlmIChsb2NhdGlvbiAmJiBoYXNoKSB7XG4gICAgICAvLyB0aGlzLmhhc2hMaW5rU2Nyb2xsKCk7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgbGFzdEhhc2hVc2VkSW5MaW5rU2Nyb2xsOiBoYXNoIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgKG5leHRQcm9wcykge1xuICAgIC8vIGNvbnNvbGUubG9nKCdCYWxsb3QgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcycpO1xuXG4gICAgLy8gV2UgZG9uJ3Qgd2FudCB0byBsZXQgdGhlIGdvb2dsZUNpdmljRWxlY3Rpb25JZCBkaXNhcHBlYXJcbiAgICBjb25zdCBnb29nbGVDaXZpY0VsZWN0aW9uSWQgPSBuZXh0UHJvcHMucGFyYW1zLmdvb2dsZV9jaXZpY19lbGVjdGlvbl9pZCB8fCB0aGlzLnN0YXRlLmdvb2dsZUNpdmljRWxlY3Rpb25JZDtcbiAgICBsZXQgYmFsbG90UmV0dXJuZWRXZVZvdGVJZCA9IG5leHRQcm9wcy5wYXJhbXMuYmFsbG90X3JldHVybmVkX3dlX3ZvdGVfaWQgfHwgJyc7XG4gICAgYmFsbG90UmV0dXJuZWRXZVZvdGVJZCA9IGJhbGxvdFJldHVybmVkV2VWb3RlSWQudHJpbSgpO1xuICAgIGxldCBiYWxsb3RMb2NhdGlvblNob3J0Y3V0ID0gbmV4dFByb3BzLnBhcmFtcy5iYWxsb3RfbG9jYXRpb25fc2hvcnRjdXQgfHwgJyc7XG4gICAgYmFsbG90TG9jYXRpb25TaG9ydGN1dCA9IGJhbGxvdExvY2F0aW9uU2hvcnRjdXQudHJpbSgpO1xuICAgIGNvbnN0IGNvbXBsZXRpb25MZXZlbEZpbHRlclR5cGUgPSBCYWxsb3RTdG9yZS5nZXRDb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlU2F2ZWQoKSB8fCAnYWxsJztcblxuICAgIC8vIFdlcmUgdGhlcmUgYW55IGFjdHVhbCBjaGFuZ2VzP1xuICAgIGlmIChiYWxsb3RSZXR1cm5lZFdlVm90ZUlkICE9PSB0aGlzLnN0YXRlLmJhbGxvdFJldHVybmVkV2VWb3RlSWQgfHxcbiAgICAgICAgYmFsbG90TG9jYXRpb25TaG9ydGN1dCAhPT0gdGhpcy5zdGF0ZS5iYWxsb3RMb2NhdGlvblNob3J0Y3V0IHx8XG4gICAgICAgIGdvb2dsZUNpdmljRWxlY3Rpb25JZCAhPT0gdGhpcy5zdGF0ZS5nb29nbGVDaXZpY0VsZWN0aW9uSWQgfHxcbiAgICAgICAgY29tcGxldGlvbkxldmVsRmlsdGVyVHlwZSAhPT0gdGhpcy5zdGF0ZS5jb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnQmFsbG90IGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgY2hhbmdlcyBmb3VuZCcpO1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGJhbGxvdFdpdGhBbGxJdGVtczogQmFsbG90U3RvcmUuZ2V0QmFsbG90QnlDb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlKCdhbGwnKSxcbiAgICAgICAgYmFsbG90V2l0aEl0ZW1zRnJvbUNvbXBsZXRpb25GaWx0ZXJUeXBlOiBCYWxsb3RTdG9yZS5nZXRCYWxsb3RCeUNvbXBsZXRpb25MZXZlbEZpbHRlclR5cGUoY29tcGxldGlvbkxldmVsRmlsdGVyVHlwZSksXG4gICAgICAgIGJhbGxvdFJldHVybmVkV2VWb3RlSWQsXG4gICAgICAgIGJhbGxvdExvY2F0aW9uU2hvcnRjdXQsXG4gICAgICAgIGNvbXBsZXRpb25MZXZlbEZpbHRlclR5cGUsXG4gICAgICAgIGdvb2dsZUNpdmljRWxlY3Rpb25JZDogcGFyc2VJbnQoZ29vZ2xlQ2l2aWNFbGVjdGlvbklkLCAxMCksXG4gICAgICAgIGxvY2F0aW9uOiBuZXh0UHJvcHMubG9jYXRpb24sXG4gICAgICAgIHBhdGhuYW1lOiBuZXh0UHJvcHMubG9jYXRpb24ucGF0aG5hbWUsXG4gICAgICB9KTtcbiAgICAgIGlmIChnb29nbGVDaXZpY0VsZWN0aW9uSWQgJiYgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkICE9PSAwKSB7XG4gICAgICAgIEFuYWx5dGljc0FjdGlvbnMuc2F2ZUFjdGlvbkJhbGxvdFZpc2l0KGdvb2dsZUNpdmljRWxlY3Rpb25JZCk7XG4gICAgICB9IGVsc2UgaWYgKFZvdGVyU3RvcmUuZWxlY3Rpb25JZCgpKSB7XG4gICAgICAgIEFuYWx5dGljc0FjdGlvbnMuc2F2ZUFjdGlvbkJhbGxvdFZpc2l0KFZvdGVyU3RvcmUuZWxlY3Rpb25JZCgpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gY29uc29sZS5sb2coJ0JhbGxvdCBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIE5PIGNoYW5nZXMgZm91bmQnKTtcbiAgICB9XG5cbiAgICBpZiAobmV4dFByb3BzLmxvY2F0aW9uICYmIG5leHRQcm9wcy5sb2NhdGlvbi5oYXNoKSB7XG4gICAgICAvLyB0aGlzLmhhc2hMaW5rU2Nyb2xsKCk7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgbGFzdEhhc2hVc2VkSW5MaW5rU2Nyb2xsOiBuZXh0UHJvcHMubG9jYXRpb24uaGFzaCB9KTtcbiAgICB9XG4gIH1cblxuICBzaG91bGRDb21wb25lbnRVcGRhdGUgKG5leHRQcm9wcywgbmV4dFN0YXRlKSB7XG4gICAgLy8gVGhpcyBsaWZlY3ljbGUgbWV0aG9kIHRlbGxzIHRoZSBjb21wb25lbnQgdG8gTk9UIHJlbmRlciBpZiBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIGRpZG4ndCBzZWUgYW55IGNoYW5nZXNcbiAgICByZXR1cm4gY2hlY2tTaG91bGRVcGRhdGUodGhpcy5zdGF0ZSwgbmV4dFN0YXRlKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSAocHJldlByb3BzLCBwcmV2U3RhdGUpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnQmFsbG90IGNvbXBvbmVudERpZFVwZGF0ZScpO1xuICAgIGNvbnN0IHsgYmFsbG90V2l0aEFsbEl0ZW1zLCBmb3VuZEZpcnN0UmFjZUxldmVsLCByYWNlTGV2ZWxGaWx0ZXJUeXBlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGlmICghZm91bmRGaXJzdFJhY2VMZXZlbCkge1xuICAgICAgLy8gV2Ugb25seSBuZWVkIHRvIGJlIGhlcmUgaWYgd2UgaGF2ZW4ndCBmb3VuZCB0aGUgZmlyc3QgUmFjZSBsZXZlbCB3ZSBhcmUgZ29pbmcgdG8gc2hvdywgb3Igd2UgZG9uJ3QgaGF2ZSBhIHJhY2VMZXZlbEZpbHRlclR5cGUgaWRlbnRpZmllZFxuICAgICAgbGV0IHsgbmV3UmFjZUxldmVsRmlsdGVyVHlwZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgIGxldCByYWNlTGV2ZWxGaWx0ZXJUeXBlQ2hhbmdlZCA9IGZhbHNlO1xuICAgICAgLy8gY29uc29sZS5sb2coJ0JhbGxvdCwgY29tcG9uZW50RGlkVXBkYXRlIHJhY2VMZXZlbEZpbHRlclR5cGUgQkVGT1JFOicsIHJhY2VMZXZlbEZpbHRlclR5cGUsICcsIG5ld1JhY2VMZXZlbEZpbHRlclR5cGU6ICcsIG5ld1JhY2VMZXZlbEZpbHRlclR5cGUpO1xuXG4gICAgICBsZXQgcmFjZUxldmVsRmlsdGVySXRlbXNJblRoaXNCYWxsb3QgPSBbXTtcbiAgICAgIGlmIChiYWxsb3RXaXRoQWxsSXRlbXMgJiYgYmFsbG90V2l0aEFsbEl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnQmFsbG90LCBjb21wb25lbnREaWRVcGRhdGUgYmFsbG90V2l0aEFsbEl0ZW1zOicsIHRoaXMuc3RhdGUuYmFsbG90V2l0aEFsbEl0ZW1zKTtcbiAgICAgICAgLy8gY29uc3QgcmFjZUxldmVsRmlsdGVySXRlbXMgPSBiYWxsb3RXaXRoQWxsSXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5yYWNlX29mZmljZV9sZXZlbCA9PT0gcmFjZUxldmVsRmlsdGVyVHlwZSB8fFxuICAgICAgICAvLyAgIGl0ZW0ua2luZF9vZl9iYWxsb3RfaXRlbSA9PT0gcmFjZUxldmVsRmlsdGVyVHlwZS50b1VwcGVyQ2FzZSgpKTtcbiAgICAgICAgbGV0IGN1cnJlbnRJbmRleCA9IDA7XG4gICAgICAgIGxldCBsb3dlc3RJbmRleEZvdW5kID0gMztcbiAgICAgICAgY29uc3QgcmFjZUxldmVsc0FscmVhZHlGb3VuZCA9IFtdO1xuICAgICAgICBsZXQgYmFsbG90SXRlbVJhY2VPZmZpY2VMZXZlbDtcbiAgICAgICAgbGV0IHJhY2VMZXZlbENhcGl0YWxpemVkO1xuICAgICAgICBsZXQgYmFsbG90SXRlbUtpbmRPZk9mZmljZUl0ZW07XG4gICAgICAgIHJhY2VMZXZlbEZpbHRlckl0ZW1zSW5UaGlzQmFsbG90ID0gYmFsbG90V2l0aEFsbEl0ZW1zLmZpbHRlcigoYmFsbG90SXRlbSkgPT4ge1xuICAgICAgICAgIC8vIElmIHRydWUgY29tZXMgYmFjayBmcm9tIHRoaXMgZmlsdGVyLCB0aGUgXCJtYXBcIiB0YWNrZWQgb250byB0aGUgZW5kIG9mIHRoaXMgcmV0dXJucyBqdXN0IHRoZSByYWNlX29mZmljZV9sZXZlbFxuICAgICAgICAgIHJhY2VMZXZlbENhcGl0YWxpemVkID0gJyc7XG4gICAgICAgICAgYmFsbG90SXRlbVJhY2VPZmZpY2VMZXZlbCA9IGJhbGxvdEl0ZW0ucmFjZV9vZmZpY2VfbGV2ZWwgfHwgJyc7XG4gICAgICAgICAgaWYgKGJhbGxvdEl0ZW1SYWNlT2ZmaWNlTGV2ZWwpIHtcbiAgICAgICAgICAgIC8vIEZvciBGZWRlcmFsLCBTdGF0ZSwgTG9jYWxcbiAgICAgICAgICAgIHJhY2VMZXZlbENhcGl0YWxpemVkID0gYmFsbG90SXRlbVJhY2VPZmZpY2VMZXZlbC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGJhbGxvdEl0ZW1SYWNlT2ZmaWNlTGV2ZWwuc2xpY2UoMSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gRm9yIE1lYXN1cmVzXG4gICAgICAgICAgICBiYWxsb3RJdGVtS2luZE9mT2ZmaWNlSXRlbSA9IGJhbGxvdEl0ZW0ua2luZF9vZl9iYWxsb3RfaXRlbSB8fCAnJztcbiAgICAgICAgICAgIHJhY2VMZXZlbENhcGl0YWxpemVkID0gYmFsbG90SXRlbUtpbmRPZk9mZmljZUl0ZW0uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBiYWxsb3RJdGVtS2luZE9mT2ZmaWNlSXRlbS5zbGljZSgxKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJyZW50SW5kZXggPSBCQUxMT1RfSVRFTV9GSUxURVJfVFlQRVMuaW5kZXhPZihyYWNlTGV2ZWxDYXBpdGFsaXplZCk7XG4gICAgICAgICAgaWYgKGN1cnJlbnRJbmRleCA+IC0xKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudEluZGV4IDwgbG93ZXN0SW5kZXhGb3VuZCkge1xuICAgICAgICAgICAgICBuZXdSYWNlTGV2ZWxGaWx0ZXJUeXBlID0gcmFjZUxldmVsQ2FwaXRhbGl6ZWQ7XG4gICAgICAgICAgICAgIGxvd2VzdEluZGV4Rm91bmQgPSBjdXJyZW50SW5kZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmFjZUxldmVsc0FscmVhZHlGb3VuZC5pbmRleE9mKHJhY2VMZXZlbENhcGl0YWxpemVkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgLy8gSWYgdGhpcyBvZmZpY2UgbGV2ZWwgaGFzbid0IGFscmVhZHkgYmVlbiBhZGRlZCwgdGhlbiBhZGQgaXRcbiAgICAgICAgICAgICAgcmFjZUxldmVsc0FscmVhZHlGb3VuZC5wdXNoKHJhY2VMZXZlbENhcGl0YWxpemVkKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHJhY2VMZXZlbENhcGl0YWxpemVkO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9KS5tYXAoKGJhbGxvdEl0ZW0pID0+IHtcbiAgICAgICAgICByYWNlTGV2ZWxDYXBpdGFsaXplZCA9ICcnO1xuICAgICAgICAgIGJhbGxvdEl0ZW1SYWNlT2ZmaWNlTGV2ZWwgPSBiYWxsb3RJdGVtLnJhY2Vfb2ZmaWNlX2xldmVsIHx8ICcnO1xuICAgICAgICAgIGlmIChiYWxsb3RJdGVtUmFjZU9mZmljZUxldmVsKSB7XG4gICAgICAgICAgICAvLyBGb3IgRmVkZXJhbCwgU3RhdGUsIExvY2FsXG4gICAgICAgICAgICByYWNlTGV2ZWxDYXBpdGFsaXplZCA9IGJhbGxvdEl0ZW1SYWNlT2ZmaWNlTGV2ZWwuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBiYWxsb3RJdGVtUmFjZU9mZmljZUxldmVsLnNsaWNlKDEpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEZvciBNZWFzdXJlc1xuICAgICAgICAgICAgYmFsbG90SXRlbUtpbmRPZk9mZmljZUl0ZW0gPSBiYWxsb3RJdGVtLmtpbmRfb2ZfYmFsbG90X2l0ZW0gfHwgJyc7XG4gICAgICAgICAgICByYWNlTGV2ZWxDYXBpdGFsaXplZCA9IGJhbGxvdEl0ZW1LaW5kT2ZPZmZpY2VJdGVtLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgYmFsbG90SXRlbUtpbmRPZk9mZmljZUl0ZW0uc2xpY2UoMSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJhY2VMZXZlbENhcGl0YWxpemVkO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBXZSBtdXN0IGhhdmUgYSByYWNlTGV2ZWxGaWx0ZXJUeXBlIHRoYXQgbWF0Y2hlcyB0aGlzIGJhbGxvdFxuICAgICAgICBjb25zdCBjdXJyZW50UmFjZUxldmVsRmlsdGVyVHlwZU5vdEZvdW5kSW5CYWxsb3QgPSByYWNlTGV2ZWxGaWx0ZXJJdGVtc0luVGhpc0JhbGxvdC5pbmRleE9mKHJhY2VMZXZlbEZpbHRlclR5cGUpID09PSAtMTtcbiAgICAgICAgaWYgKCFyYWNlTGV2ZWxGaWx0ZXJUeXBlIHx8IGN1cnJlbnRSYWNlTGV2ZWxGaWx0ZXJUeXBlTm90Rm91bmRJbkJhbGxvdCkge1xuICAgICAgICAgIG5ld1JhY2VMZXZlbEZpbHRlclR5cGUgPSBCQUxMT1RfSVRFTV9GSUxURVJfVFlQRVNbbG93ZXN0SW5kZXhGb3VuZF07XG4gICAgICAgICAgcmFjZUxldmVsRmlsdGVyVHlwZUNoYW5nZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc2V0U3RhdGUoeyByYWNlTGV2ZWxGaWx0ZXJJdGVtc0luVGhpc0JhbGxvdCB9KTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdCYWxsb3QsIGNvbXBvbmVudERpZFVwZGF0ZSByYWNlTGV2ZWxGaWx0ZXJUeXBlIEFGVEVSOicsIHJhY2VMZXZlbEZpbHRlclR5cGUsICcsIG5ld1JhY2VMZXZlbEZpbHRlclR5cGU6ICcsIG5ld1JhY2VMZXZlbEZpbHRlclR5cGUpO1xuICAgICAgLy8gY29uc29sZS5sb2coJ0JhbGxvdCwgY29tcG9uZW50RGlkVXBkYXRlIHJhY2VMZXZlbEZpbHRlckl0ZW1zSW5UaGlzQmFsbG90OicsIHJhY2VMZXZlbEZpbHRlckl0ZW1zSW5UaGlzQmFsbG90KTtcblxuICAgICAgaWYgKHRoaXMuc3RhdGUubGFzdEhhc2hVc2VkSW5MaW5rU2Nyb2xsICYmIHRoaXMuc3RhdGUubGFzdEhhc2hVc2VkSW5MaW5rU2Nyb2xsICE9PSBwcmV2U3RhdGUubGFzdEhhc2hVc2VkSW5MaW5rU2Nyb2xsKSB7XG4gICAgICAgIHRoaXMuaGFzaExpbmtTY3JvbGwoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFmb3VuZEZpcnN0UmFjZUxldmVsIHx8IHJhY2VMZXZlbEZpbHRlclR5cGVDaGFuZ2VkKSB7XG4gICAgICAgIGlmIChyYWNlTGV2ZWxGaWx0ZXJUeXBlQ2hhbmdlZCkge1xuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgcmFjZUxldmVsRmlsdGVyVHlwZTogbmV3UmFjZUxldmVsRmlsdGVyVHlwZSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBmb3VuZEZpcnN0UmFjZUxldmVsOiB0cnVlLFxuICAgICAgICAgIHNob3dGaWx0ZXJUYWJzOiByYWNlTGV2ZWxGaWx0ZXJJdGVtc0luVGhpc0JhbGxvdC5sZW5ndGggPiAxLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCAoKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ0JhbGxvdCBjb21wb25lbnRXaWxsVW5tb3VudCcpO1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgbW91bnRlZDogZmFsc2UsXG4gICAgfSk7XG5cbiAgICB0aGlzLmJhbGxvdFN0b3JlTGlzdGVuZXIucmVtb3ZlKCk7XG4gICAgdGhpcy5lbGVjdGlvbkxpc3RMaXN0ZW5lci5yZW1vdmUoKTtcbiAgICB0aGlzLnN1cHBvcnRTdG9yZUxpc3RlbmVyLnJlbW92ZSgpO1xuICAgIHRoaXMudm90ZXJHdWlkZVN0b3JlTGlzdGVuZXIucmVtb3ZlKCk7XG4gICAgdGhpcy52b3RlclN0b3JlTGlzdGVuZXIucmVtb3ZlKCk7XG4gICAgdGhpcy5hcHBTdG9yZUxpc3RlbmVyLnJlbW92ZSgpO1xuICAgIHRoaXMudGltZXIgPSBudWxsO1xuICB9XG5cbiAgLy8gU2VlIGh0dHBzOi8vcmVhY3Rqcy5vcmcvZG9jcy9lcnJvci1ib3VuZGFyaWVzLmh0bWxcbiAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21FcnJvciAoZXJyb3IpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIC8vIFVwZGF0ZSBzdGF0ZSBzbyB0aGUgbmV4dCByZW5kZXIgd2lsbCBzaG93IHRoZSBmYWxsYmFjayBVSSwgV2Ugc2hvdWxkIGhhdmUgYSAnT2ggc25hcCcgcGFnZVxuICAgIHJldHVybiB7IGhhc0Vycm9yOiB0cnVlIH07XG4gIH1cblxuICBvbkFwcFN0b3JlQ2hhbmdlICgpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGJhbGxvdEhlYWRlclVucGlubmVkOiBBcHBTdG9yZS5nZXRTY3JvbGxlZERvd24oKSxcbiAgICAgIHNob3dTZWxlY3RCYWxsb3RNb2RhbDogQXBwU3RvcmUuc2hvd1NlbGVjdEJhbGxvdE1vZGFsKCksXG4gICAgfSk7XG4gICAgY29uc3QgeyBnb29nbGVDaXZpY0VsZWN0aW9uSWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgbWVtYmVyc2hpcE9yZ2FuaXphdGlvbldlVm90ZUlkID0gQXBwU3RvcmUuZ2V0U2l0ZU93bmVyT3JnYW5pemF0aW9uV2VWb3RlSWQoKTtcbiAgICAvLyBjb25zb2xlLmxvZygnb25BcHBTdG9yZUNoYW5nZSBtZW1iZXJzaGlwT3JnYW5pemF0aW9uV2VWb3RlSWQ6ICcsIG1lbWJlcnNoaXBPcmdhbml6YXRpb25XZVZvdGVJZCk7XG4gICAgaWYgKG1lbWJlcnNoaXBPcmdhbml6YXRpb25XZVZvdGVJZCkge1xuICAgICAgY29uc3QgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkVmlld2VkID0gZ29vZ2xlQ2l2aWNFbGVjdGlvbklkIHx8IFZvdGVyU3RvcmUuZWxlY3Rpb25JZCgpO1xuICAgICAgaWYgKCF0aGlzLm1lbWJlclZpZXdlZEJhbGxvdEhhc0JlZW5TYXZlZE9uY2UobWVtYmVyc2hpcE9yZ2FuaXphdGlvbldlVm90ZUlkLCBnb29nbGVDaXZpY0VsZWN0aW9uSWRWaWV3ZWQpKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdvbkFwcFN0b3JlQ2hhbmdlIGdldHRpbmcgcmVhZHkgdG8gc2F2ZTogJywgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkVmlld2VkKTtcbiAgICAgICAgaWYgKGdvb2dsZUNpdmljRWxlY3Rpb25JZFZpZXdlZCAmJiBnb29nbGVDaXZpY0VsZWN0aW9uSWRWaWV3ZWQgIT09IDApIHtcbiAgICAgICAgICBBbmFseXRpY3NBY3Rpb25zLnNhdmVBY3Rpb25CYWxsb3RWaXNpdChnb29nbGVDaXZpY0VsZWN0aW9uSWRWaWV3ZWQpO1xuICAgICAgICAgIHRoaXMubWVtYmVyVmlld2VkQmFsbG90KG1lbWJlcnNoaXBPcmdhbml6YXRpb25XZVZvdGVJZCwgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkVmlld2VkKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ29uQXBwU3RvcmVDaGFuZ2UgYWxyZWFkeSBzYXZlZDogJywgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkVmlld2VkKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvblZvdGVyU3RvcmVDaGFuZ2UgKCkge1xuICAgIC8vIGNvbnNvbGUubG9nKCdCYWxsb3QuanN4IG9uVm90ZXJTdG9yZUNoYW5nZScpO1xuICAgIGNvbnN0IHsgbW91bnRlZCwgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkIH0gPSB0aGlzLnN0YXRlO1xuICAgIGlmIChtb3VudGVkKSB7XG4gICAgICBsZXQgdm90ZXJSZWZyZXNoVGltZXJPbiA9IGZhbHNlO1xuICAgICAgaWYgKHRoaXMucHJvcHMubG9jYXRpb24gJiYgdGhpcy5wcm9wcy5sb2NhdGlvbi5xdWVyeSAmJiB0aGlzLnByb3BzLmxvY2F0aW9uLnF1ZXJ5LnZvdGVyX3JlZnJlc2hfdGltZXJfb24pIHtcbiAgICAgICAgdm90ZXJSZWZyZXNoVGltZXJPbiA9ICh0aGlzLnByb3BzLmxvY2F0aW9uLnF1ZXJ5LnZvdGVyX3JlZnJlc2hfdGltZXJfb24pO1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnb25Wb3RlclN0b3JlQ2hhbmdlIHZvdGVyUmVmcmVzaFRpbWVyT246ICcsIHZvdGVyUmVmcmVzaFRpbWVyT24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ29uVm90ZXJTdG9yZUNoYW5nZSB2b3RlclJlZnJlc2hUaW1lck9uIGlzIEZBTFNFJyk7XG4gICAgICB9XG4gICAgICBpZiAodm90ZXJSZWZyZXNoVGltZXJPbikge1xuICAgICAgICBjb25zdCB2b3RlciA9IFZvdGVyU3RvcmUuZ2V0Vm90ZXIoKTtcbiAgICAgICAgY29uc3QgeyBudW1iZXJPZlZvdGVyUmV0cmlldmVBdHRlbXB0cyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKHZvdGVyICYmIHZvdGVyLmlzX3NpZ25lZF9pbikge1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdvblZvdGVyU3RvcmVDaGFuZ2UsIGFib3V0IHRvIGhpc3RvcnlQdXNoKHRoaXMuc3RhdGUucGF0aG5hbWUpOicsIHRoaXMuc3RhdGUucGF0aG5hbWUpO1xuICAgICAgICAgIC8vIFJldHVybiB0byB0aGUgc2FtZSBwYWdlIHdpdGhvdXQgdGhlIFwidm90ZXJfcmVmcmVzaF90aW1lcl9vblwiIHZhcmlhYmxlXG4gICAgICAgICAgaGlzdG9yeVB1c2godGhpcy5zdGF0ZS5wYXRobmFtZSk7XG4gICAgICAgIH0gZWxzZSBpZiAobnVtYmVyT2ZWb3RlclJldHJpZXZlQXR0ZW1wdHMgPCAzKSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coJ0Fib3V0IHRvIHN0YXJ0VGltZXJUb1JldHJpZXZlVm90ZXInKTtcbiAgICAgICAgICB0aGlzLnN0YXJ0VGltZXJUb1JldHJpZXZlVm90ZXIoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBXZSBoYXZlIGV4Y2VlZGVkIHRoZSBudW1iZXIgb2YgYWxsb3dlZCBhdHRlbXB0cyBhbmQgd2FudCB0byBcInR1cm4gb2ZmXCIgdGhlIHJlcXVlc3QgdG8gcmVmcmVzaCB0aGUgdm90ZXIgb2JqZWN0XG4gICAgICAgICAgLy8gUmV0dXJuIHRvIHRoZSBzYW1lIHBhZ2Ugd2l0aG91dCB0aGUgXCJ2b3Rlcl9yZWZyZXNoX3RpbWVyX29uXCIgdmFyaWFibGVcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnRXhpdGluZyB2b3RlclJlZnJlc2hUaW1lck9uJyk7XG4gICAgICAgICAgaGlzdG9yeVB1c2godGhpcy5zdGF0ZS5wYXRobmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdCYWxsb3QuanN4IG9uVm90ZXJTdG9yZUNoYW5nZSBWb3RlclN0b3JlLmdldFZvdGVyOiAnLCBWb3RlclN0b3JlLmdldFZvdGVyKCkpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBnb29nbGVDaXZpY0VsZWN0aW9uSWQ6IHBhcnNlSW50KFZvdGVyU3RvcmUuZWxlY3Rpb25JZCgpLCAxMCksXG4gICAgICAgICAgdGV4dEZvck1hcFNlYXJjaDogVm90ZXJTdG9yZS5nZXRUZXh0Rm9yTWFwU2VhcmNoKCksXG4gICAgICAgICAgdm90ZXI6IFZvdGVyU3RvcmUuZ2V0Vm90ZXIoKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCBtZW1iZXJzaGlwT3JnYW5pemF0aW9uV2VWb3RlSWQgPSBBcHBTdG9yZS5nZXRTaXRlT3duZXJPcmdhbml6YXRpb25XZVZvdGVJZCgpO1xuICAgICAgLy8gY29uc29sZS5sb2coJ29uVm90ZXJTdG9yZUNoYW5nZSBtZW1iZXJzaGlwT3JnYW5pemF0aW9uV2VWb3RlSWQ6ICcsIG1lbWJlcnNoaXBPcmdhbml6YXRpb25XZVZvdGVJZCk7XG4gICAgICBpZiAobWVtYmVyc2hpcE9yZ2FuaXphdGlvbldlVm90ZUlkKSB7XG4gICAgICAgIGNvbnN0IGdvb2dsZUNpdmljRWxlY3Rpb25JZFZpZXdlZCA9IGdvb2dsZUNpdmljRWxlY3Rpb25JZCB8fCBWb3RlclN0b3JlLmVsZWN0aW9uSWQoKTtcbiAgICAgICAgaWYgKCF0aGlzLm1lbWJlclZpZXdlZEJhbGxvdEhhc0JlZW5TYXZlZE9uY2UobWVtYmVyc2hpcE9yZ2FuaXphdGlvbldlVm90ZUlkLCBnb29nbGVDaXZpY0VsZWN0aW9uSWRWaWV3ZWQpKSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coJ29uVm90ZXJTdG9yZUNoYW5nZSBnZXR0aW5nIHJlYWR5IHRvIHNhdmU6ICcsIGdvb2dsZUNpdmljRWxlY3Rpb25JZFZpZXdlZCk7XG4gICAgICAgICAgaWYgKGdvb2dsZUNpdmljRWxlY3Rpb25JZFZpZXdlZCAmJiBnb29nbGVDaXZpY0VsZWN0aW9uSWRWaWV3ZWQgIT09IDApIHtcbiAgICAgICAgICAgIEFuYWx5dGljc0FjdGlvbnMuc2F2ZUFjdGlvbkJhbGxvdFZpc2l0KGdvb2dsZUNpdmljRWxlY3Rpb25JZFZpZXdlZCk7XG4gICAgICAgICAgICB0aGlzLm1lbWJlclZpZXdlZEJhbGxvdChtZW1iZXJzaGlwT3JnYW5pemF0aW9uV2VWb3RlSWQsIGdvb2dsZUNpdmljRWxlY3Rpb25JZFZpZXdlZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdvblZvdGVyU3RvcmVDaGFuZ2UgYWxyZWFkeSBzYXZlZDogJywgZ29vZ2xlQ2l2aWNFbGVjdGlvbklkVmlld2VkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG9uQmFsbG90U3RvcmVDaGFuZ2UgKCkge1xuICAgIC8vIGNvbnNvbGUubG9nKCdCYWxsb3QuanN4IG9uQmFsbG90U3RvcmVDaGFuZ2UnKTtcbiAgICBjb25zdCBjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlID0gQmFsbG90U3RvcmUuZ2V0Q29tcGxldGlvbkxldmVsRmlsdGVyVHlwZVNhdmVkKCkgfHwgJyc7XG4gICAgY29uc3QgeyBiYWxsb3QsIGJhbGxvdFByb3BlcnRpZXMgfSA9IEJhbGxvdFN0b3JlO1xuICAgIC8vIGNvbnNvbGUubG9nKCdCYWxsb3QuanN4IG9uQmFsbG90U3RvcmVjaGFuZ2UsIGJhbGxvdFByb3BlcnRpZXM6ICcsIGJhbGxvdFByb3BlcnRpZXMpO1xuICAgIGNvbnN0IHtcbiAgICAgIG1vdW50ZWQsIGlzc3Vlc1JldHJpZXZlZEZyb21Hb29nbGVDaXZpY0VsZWN0aW9uSWQsXG4gICAgICBpc3N1ZXNSZXRyaWV2ZWRGcm9tQmFsbG90UmV0dXJuZWRXZVZvdGVJZCwgaXNzdWVzUmV0cmlldmVkRnJvbUJhbGxvdExvY2F0aW9uU2hvcnRjdXQsXG4gICAgfSA9IHRoaXMuc3RhdGU7XG4gICAgbGV0IHsgcmFjZUxldmVsRmlsdGVyVHlwZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBpZiAoIXJhY2VMZXZlbEZpbHRlclR5cGUpIHtcbiAgICAgIHJhY2VMZXZlbEZpbHRlclR5cGUgPSAnJzsgLy8gTWFrZSBzdXJlIHRoaXMgaXMgYSBzdHJpbmdcbiAgICB9XG5cbiAgICBpZiAobW91bnRlZCkge1xuICAgICAgaWYgKGJhbGxvdFByb3BlcnRpZXMgJiYgYmFsbG90UHJvcGVydGllcy5iYWxsb3RfZm91bmQgJiYgYmFsbG90ICYmIGJhbGxvdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgLy8gQmFsbG90IGlzIGZvdW5kIGJ1dCBiYWxsb3QgaXMgZW1wdHkuIFdlIHdhbnQgdG8gc3RheSBwdXQuXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdvbkJhbGxvdFN0b3JlQ2hhbmdlOiBiYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGUgaXMgZW1wdHknKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGJhbGxvdFdpdGhBbGxJdGVtcyA9IEJhbGxvdFN0b3JlLmdldEJhbGxvdEJ5Q29tcGxldGlvbkxldmVsRmlsdGVyVHlwZSgnYWxsJyk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlOiAnLCBjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlKTtcbiAgICAgICAgbGV0IGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZSA9IEJhbGxvdFN0b3JlLmdldEJhbGxvdEJ5Q29tcGxldGlvbkxldmVsRmlsdGVyVHlwZShjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlKTtcbiAgICAgICAgaWYgKGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZSAmJiBiYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGUubGVuZ3RoKSB7XG4gICAgICAgICAgY29uc3QgcmFjZUxldmVsRmlsdGVySXRlbXMgPSBiYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGUuZmlsdGVyKGl0ZW0gPT4gaXRlbS5yYWNlX29mZmljZV9sZXZlbCA9PT0gcmFjZUxldmVsRmlsdGVyVHlwZSB8fFxuICAgICAgICAgICAgaXRlbS5raW5kX29mX2JhbGxvdF9pdGVtID09PSByYWNlTGV2ZWxGaWx0ZXJUeXBlLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZG91YmxlRmlsdGVyZWRCYWxsb3RJdGVtc0xlbmd0aDogcmFjZUxldmVsRmlsdGVySXRlbXMubGVuZ3RoLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIElmIGhlcmUsIHRoZSAnY29tcGxldGlvbkxldmVsRmlsdGVyVHlwZScgaGFzIGJlZW4gbWFkZSBvYnNvbGV0ZS5cbiAgICAgICAgICAvLyBVbmZvcnR1bmF0ZWx5IHdlIGNhbid0IHJlc2V0IGl0IHdpdGhvdXQgY3JlYXRpbmcgYSBkaXNwYXRjaCBsb29wXG4gICAgICAgICAgLy8gQmFsbG90QWN0aW9ucy5jb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlU2F2ZSgnYWxsJyk7XG4gICAgICAgICAgYmFsbG90V2l0aEl0ZW1zRnJvbUNvbXBsZXRpb25GaWx0ZXJUeXBlID0gYmFsbG90V2l0aEFsbEl0ZW1zO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIGJhbGxvdFdpdGhBbGxJdGVtcyxcbiAgICAgICAgICBiYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGUsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYmFsbG90UHJvcGVydGllcykge1xuICAgICAgLy8gSWYgdGhlIGluY29taW5nIGdvb2dsZUNpdmljRWxlY3Rpb25JZCwgYmFsbG90UmV0dXJuZWRXZVZvdGVJZCwgb3IgYmFsbG90TG9jYXRpb25TaG9ydGN1dCBhcmUgZGlmZmVyZW50LCBjYWxsIGlzc3Vlc1JldHJpZXZlRm9yRWxlY3Rpb25cbiAgICAgIGlmIChwYXJzZUludChiYWxsb3RQcm9wZXJ0aWVzLmdvb2dsZV9jaXZpY19lbGVjdGlvbl9pZCwgMTApICE9PSBpc3N1ZXNSZXRyaWV2ZWRGcm9tR29vZ2xlQ2l2aWNFbGVjdGlvbklkIHx8XG4gICAgICAgICAgYmFsbG90UHJvcGVydGllcy5iYWxsb3RfcmV0dXJuZWRfd2Vfdm90ZV9pZCAhPT0gaXNzdWVzUmV0cmlldmVkRnJvbUJhbGxvdFJldHVybmVkV2VWb3RlSWQgfHxcbiAgICAgICAgICBiYWxsb3RQcm9wZXJ0aWVzLmJhbGxvdF9sb2NhdGlvbl9zaG9ydGN1dCAhPT0gaXNzdWVzUmV0cmlldmVkRnJvbUJhbGxvdExvY2F0aW9uU2hvcnRjdXQpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ29uQmFsbG90U3RvcmVDaGFuZ2UsIENhbGxpbmcgaXNzdWVzUmV0cmlldmVGb3JFbGVjdGlvbicpO1xuXG4gICAgICAgIGlmIChJc3N1ZVN0b3JlLmdldFByZXZpb3VzR29vZ2xlQ2l2aWNFbGVjdGlvbklkKCkgPCAxKSB7XG4gICAgICAgICAgSXNzdWVBY3Rpb25zLmlzc3Vlc1JldHJpZXZlRm9yRWxlY3Rpb24oYmFsbG90UHJvcGVydGllcy5nb29nbGVfY2l2aWNfZWxlY3Rpb25faWQsIGJhbGxvdFByb3BlcnRpZXMuYmFsbG90X2xvY2F0aW9uX3Nob3J0Y3V0LCBiYWxsb3RQcm9wZXJ0aWVzLmJhbGxvdF9yZXR1cm5lZF93ZV92b3RlX2lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIGlzc3Vlc1JldHJpZXZlZEZyb21Hb29nbGVDaXZpY0VsZWN0aW9uSWQ6IHBhcnNlSW50KEJhbGxvdFN0b3JlLmJhbGxvdFByb3BlcnRpZXMuZ29vZ2xlX2NpdmljX2VsZWN0aW9uX2lkLCAxMCksXG4gICAgICAgICAgaXNzdWVzUmV0cmlldmVkRnJvbUJhbGxvdFJldHVybmVkV2VWb3RlSWQ6IEJhbGxvdFN0b3JlLmJhbGxvdFByb3BlcnRpZXMuYmFsbG90X3JldHVybmVkX3dlX3ZvdGVfaWQsXG4gICAgICAgICAgaXNzdWVzUmV0cmlldmVkRnJvbUJhbGxvdExvY2F0aW9uU2hvcnRjdXQ6IEJhbGxvdFN0b3JlLmJhbGxvdFByb3BlcnRpZXMuYmFsbG90X2xvY2F0aW9uX3Nob3J0Y3V0LFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGJhbGxvdFJldHVybmVkV2VWb3RlSWQ6IGJhbGxvdFByb3BlcnRpZXMuYmFsbG90X3JldHVybmVkX3dlX3ZvdGVfaWQgfHwgJycsXG4gICAgICAgIGJhbGxvdExvY2F0aW9uU2hvcnRjdXQ6IGJhbGxvdFByb3BlcnRpZXMuYmFsbG90X2xvY2F0aW9uX3Nob3J0Y3V0IHx8ICcnLFxuICAgICAgICBnb29nbGVDaXZpY0VsZWN0aW9uSWQ6IHBhcnNlSW50KGJhbGxvdFByb3BlcnRpZXMuZ29vZ2xlX2NpdmljX2VsZWN0aW9uX2lkLCAxMCksXG4gICAgICAgIHRleHRGb3JNYXBTZWFyY2hGcm9tQmFsbG90OiBiYWxsb3RQcm9wZXJ0aWVzLnRleHRfZm9yX21hcF9zZWFyY2ggfHwgJycsXG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBiYWxsb3RFbGVjdGlvbkxpc3Q6IEJhbGxvdFN0b3JlLmJhbGxvdEVsZWN0aW9uTGlzdCgpLFxuICAgICAgY29tcGxldGlvbkxldmVsRmlsdGVyVHlwZSxcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLnN0YXRlLmJhbGxvdExlbmd0aCAhPT0gQmFsbG90U3RvcmUuYmFsbG90TGVuZ3RoKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgYmFsbG90TGVuZ3RoOiBCYWxsb3RTdG9yZS5iYWxsb3RMZW5ndGgsXG4gICAgICAgIC8vIHJhY2VMZXZlbEZpbHRlclR5cGU6ICdGZWRlcmFsJyxcbiAgICAgICAgc2hvd0ZpbHRlclRhYnM6IGZhbHNlLFxuICAgICAgICBmb3VuZEZpcnN0UmFjZUxldmVsOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAodGhpcy5zdGF0ZS5iYWxsb3RSZW1haW5pbmdDaG9pY2VzTGVuZ3RoICE9PSBCYWxsb3RTdG9yZS5iYWxsb3RSZW1haW5pbmdDaG9pY2VzTGVuZ3RoKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgYmFsbG90UmVtYWluaW5nQ2hvaWNlc0xlbmd0aDogQmFsbG90U3RvcmUuYmFsbG90UmVtYWluaW5nQ2hvaWNlc0xlbmd0aCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLnN0YXRlLmJhbGxvdEl0ZW1VbmZ1cmxlZFRyYWNrZXIpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgLy8gY29uc29sZS5sb2coJ2N1cnJlbnQgdHJhY2tlciBpbiBCYWxsb3RzdG9yZScsIEJhbGxvdFN0b3JlLmN1cnJlbnRfYmFsbG90X2l0ZW1fdW5mdXJsZWRfdHJhY2tlcilcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBiYWxsb3RJdGVtVW5mdXJsZWRUcmFja2VyOiBCYWxsb3RTdG9yZS5jdXJyZW50QmFsbG90SXRlbVVuZnVybGVkVHJhY2tlcixcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIG9uRWxlY3Rpb25TdG9yZUNoYW5nZSAoKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ0VsZWN0aW9ucywgb25FbGVjdGlvblN0b3JlQ2hhbmdlJyk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICB2b3RlckJhbGxvdExpc3Q6IGZvcm1hdFZvdGVyQmFsbG90TGlzdChFbGVjdGlvblN0b3JlLmdldEVsZWN0aW9uTGlzdCgpKSxcbiAgICB9KTtcbiAgfVxuXG4gIG9uVm90ZXJHdWlkZVN0b3JlQ2hhbmdlICgpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnQmFsbG90IG9uVm90ZXJHdWlkZVN0b3JlQ2hhbmdlJyk7XG4gICAgLy8gVXBkYXRlIHRoZSBkYXRhIGZvciB0aGUgbW9kYWwgdG8gaW5jbHVkZSB0aGUgcG9zaXRpb24gb2YgdGhlIG9yZ2FuaXphdGlvbiByZWxhdGVkIHRvIHRoaXMgYmFsbG90IGl0ZW1cbiAgICBjb25zdCB7IGNhbmRpZGF0ZUZvck1vZGFsLCBtZWFzdXJlRm9yTW9kYWwgfSA9IHRoaXMuc3RhdGU7XG4gICAgaWYgKGNhbmRpZGF0ZUZvck1vZGFsKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgY2FuZGlkYXRlRm9yTW9kYWw6IHtcbiAgICAgICAgICAuLi5jYW5kaWRhdGVGb3JNb2RhbCxcbiAgICAgICAgICB2b3Rlcl9ndWlkZXNfdG9fZm9sbG93X2Zvcl9sYXRlc3RfYmFsbG90X2l0ZW06IFZvdGVyR3VpZGVTdG9yZS5nZXRWb3Rlckd1aWRlc1RvRm9sbG93Rm9yTGF0ZXN0QmFsbG90SXRlbSgpLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChtZWFzdXJlRm9yTW9kYWwpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBtZWFzdXJlRm9yTW9kYWw6IHtcbiAgICAgICAgICAuLi5tZWFzdXJlRm9yTW9kYWwsXG4gICAgICAgICAgdm90ZXJfZ3VpZGVzX3RvX2ZvbGxvd19mb3JfbGF0ZXN0X2JhbGxvdF9pdGVtOiBWb3Rlckd1aWRlU3RvcmUuZ2V0Vm90ZXJHdWlkZXNUb0ZvbGxvd0ZvckxhdGVzdEJhbGxvdEl0ZW0oKSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHNldEJhbGxvdEl0ZW1GaWx0ZXJUeXBlIChyYWNlTGV2ZWxGaWx0ZXJUeXBlLCBkb3VibGVGaWx0ZXJlZEJhbGxvdEl0ZW1zTGVuZ3RoKSB7XG4gICAgQmFsbG90QWN0aW9ucy5yYWNlTGV2ZWxGaWx0ZXJUeXBlU2F2ZShyYWNlTGV2ZWxGaWx0ZXJUeXBlKTtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHJhY2VMZXZlbEZpbHRlclR5cGUsXG4gICAgICBkb3VibGVGaWx0ZXJlZEJhbGxvdEl0ZW1zTGVuZ3RoLFxuICAgICAgaXNTZWFyY2hpbmc6IGZhbHNlLFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0RW1wdHlNZXNzYWdlQnlGaWx0ZXJUeXBlIChjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlKSB7XG4gICAgc3dpdGNoIChjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlKSB7XG4gICAgICBjYXNlICdmaWx0ZXJSZW1haW5pbmcnOlxuICAgICAgICByZXR1cm4gJ1lvdSBoYXZlIGNob3NlbiBhIGNhbmRpZGF0ZSBmb3IgZXZlcnkgb2ZmaWNlIGFuZCBkZWNpZGVkIG9uIGFsbCBtZWFzdXJlcy4nO1xuICAgICAgY2FzZSAnZmlsdGVyRGVjaWRlZCc6XG4gICAgICAgIHJldHVybiAnWW91IGhhdmVuXFwndCBjaG9zZW4gYW55IGNhbmRpZGF0ZXMgb3IgZGVjaWRlZCBvbiBhbnkgbWVhc3VyZXMgeWV0Lic7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuICB9XG5cbiAgc2V0UmFjZUxldmVsRmlsdGVyVHlwZSAodHlwZSkge1xuICAgIHRoaXMuc2V0U3RhdGUoeyByYWNlTGV2ZWxGaWx0ZXJUeXBlOiB0eXBlIH0pO1xuICB9XG5cbiAgbWVtYmVyVmlld2VkQmFsbG90SGFzQmVlblNhdmVkT25jZSA9IChtZW1iZXJzaGlwT3JnYW5pemF0aW9uV2VWb3RlSWQsIGdvb2dsZUNpdmljRWxlY3Rpb25JZCkgPT4ge1xuICAgIGlmICghbWVtYmVyc2hpcE9yZ2FuaXphdGlvbldlVm90ZUlkIHx8ICFnb29nbGVDaXZpY0VsZWN0aW9uSWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgeyBtZW1iZXJWaWV3ZWRCYWxsb3RIYXNCZWVuU2F2ZWRPbmNlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGlmIChtZW1iZXJWaWV3ZWRCYWxsb3RIYXNCZWVuU2F2ZWRPbmNlW21lbWJlcnNoaXBPcmdhbml6YXRpb25XZVZvdGVJZF0pIHtcbiAgICAgIHJldHVybiBtZW1iZXJWaWV3ZWRCYWxsb3RIYXNCZWVuU2F2ZWRPbmNlW21lbWJlcnNoaXBPcmdhbml6YXRpb25XZVZvdGVJZF1bZ29vZ2xlQ2l2aWNFbGVjdGlvbklkXSB8fCBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIG1lbWJlclZpZXdlZEJhbGxvdCA9IChtZW1iZXJzaGlwT3JnYW5pemF0aW9uV2VWb3RlSWQsIGdvb2dsZUNpdmljRWxlY3Rpb25JZCkgPT4ge1xuICAgIGlmICghbWVtYmVyc2hpcE9yZ2FuaXphdGlvbldlVm90ZUlkIHx8ICFnb29nbGVDaXZpY0VsZWN0aW9uSWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgbGV0IHsgbWVtYmVyVmlld2VkQmFsbG90SGFzQmVlblNhdmVkT25jZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBpZiAoIW1lbWJlclZpZXdlZEJhbGxvdEhhc0JlZW5TYXZlZE9uY2UpIHtcbiAgICAgIG1lbWJlclZpZXdlZEJhbGxvdEhhc0JlZW5TYXZlZE9uY2UgPSB7fTtcbiAgICB9XG4gICAgaWYgKCFtZW1iZXJWaWV3ZWRCYWxsb3RIYXNCZWVuU2F2ZWRPbmNlW21lbWJlcnNoaXBPcmdhbml6YXRpb25XZVZvdGVJZF0pIHtcbiAgICAgIG1lbWJlclZpZXdlZEJhbGxvdEhhc0JlZW5TYXZlZE9uY2VbbWVtYmVyc2hpcE9yZ2FuaXphdGlvbldlVm90ZUlkXSA9IHt9O1xuICAgIH1cbiAgICBtZW1iZXJWaWV3ZWRCYWxsb3RIYXNCZWVuU2F2ZWRPbmNlW21lbWJlcnNoaXBPcmdhbml6YXRpb25XZVZvdGVJZF1bZ29vZ2xlQ2l2aWNFbGVjdGlvbklkXSA9IHRydWU7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBtZW1iZXJWaWV3ZWRCYWxsb3RIYXNCZWVuU2F2ZWRPbmNlLFxuICAgIH0pO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgc2hvd1VzZXJFbXB0eU9wdGlvbnMgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGxldCB7IHJhY2VMZXZlbEZpbHRlclR5cGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgaWYgKCFyYWNlTGV2ZWxGaWx0ZXJUeXBlKSB7XG4gICAgICByYWNlTGV2ZWxGaWx0ZXJUeXBlID0gJyc7IC8vIE1ha2Ugc3VyZSB0aGlzIGlzIGEgc3RyaW5nXG4gICAgfVxuICAgIGNvbnN0IHJhY2VMZXZlbCA9IHJhY2VMZXZlbEZpbHRlclR5cGUudG9Mb3dlckNhc2UoKTtcbiAgICBzd2l0Y2ggKGNvbXBsZXRpb25MZXZlbEZpbHRlclR5cGUpIHtcbiAgICAgIGNhc2UgJ2ZpbHRlckRlY2lkZWQnOlxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8aDM+XG4gICAgICAgICAgICAgIFlvdSBoYXZlIG5vdCBkZWNpZGVkIG9uIGFueSZuYnNwO1xuICAgICAgICAgICAgICB7cmFjZUxldmVsfVxuICAgICAgICAgICAgICAmbmJzcDtiYWxsb3QgaXRlbXMgeWV0LlxuICAgICAgICAgICAgICA8YnIgLz5cbiAgICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICAgIENsaWNrIG9uICZxdW90O1xuICAgICAgICAgICAgICB7d2luZG93LmlubmVyV2lkdGggPiA1NzUgPyAnUmVtYWluaW5nIENob2ljZXMnIDogJ0Nob2ljZXMnfVxuICAgICAgICAgICAgICAmcXVvdDsgdG8gc2VlIHRoZSZuYnNwO1xuICAgICAgICAgICAgICB7cmFjZUxldmVsfVxuICAgICAgICAgICAgICAmbmJzcDtiYWxsb3QgaXRlbXMgeW91IG5lZWQgdG8gZGVjaWRlIG9uLlxuICAgICAgICAgICAgPC9oMz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICAgIGNhc2UgJ2ZpbHRlclJlbWFpbmluZyc6XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxoMz5cbiAgICAgICAgICAgICAgWW91IGRvIG5vdCBoYXZlIGFueSByZW1haW5pbmcmbmJzcDtcbiAgICAgICAgICAgICAge3JhY2VMZXZlbEZpbHRlclR5cGUudG9Mb3dlckNhc2UoKX1cbiAgICAgICAgICAgICAgJm5ic3A7YmFsbG90IGl0ZW1zIHRvIGRlY2lkZSBvbi5cbiAgICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICAgIDxiciAvPlxuICAgICAgICAgICAgICBDbGljayBvbiAmcXVvdDtcbiAgICAgICAgICAgICAge3dpbmRvdy5pbm5lcldpZHRoID4gNTc1ID8gJ0l0ZW1zIERlY2lkZWQnIDogJ0RlY2lkZWQnfVxuICAgICAgICAgICAgICAmcXVvdDsgdG8gc2VlIHRoZSZuYnNwO1xuICAgICAgICAgICAgICB7cmFjZUxldmVsfVxuICAgICAgICAgICAgICAmbmJzcDtiYWxsb3QgaXRlbXMgeW91JmFwb3M7dmUgZGVjaWRlZCBvbi5cbiAgICAgICAgICAgIDwvaDM+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgb25CYWxsb3RTZWFyY2ggPSAoZmlsdGVyZWRJdGVtcykgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBiYWxsb3RTZWFyY2hSZXN1bHRzOiBmaWx0ZXJlZEl0ZW1zIH0pO1xuICB9O1xuXG4gIGhhbmRsZVRvZ2dsZVNlYXJjaEJhbGxvdCA9ICgpID0+IHtcbiAgICBjb25zdCB7IGlzU2VhcmNoaW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBpc1NlYXJjaGluZzogIWlzU2VhcmNoaW5nIH0pO1xuICB9O1xuXG4gIHN0YXJ0VGltZXJUb1JldHJpZXZlVm90ZXIgPSAoKSA9PiB7XG4gICAgbGV0IHsgbnVtYmVyT2ZWb3RlclJldHJpZXZlQXR0ZW1wdHMgfSA9IHRoaXMuc3RhdGU7XG4gICAgLy8gY29uc29sZS5sb2coJ3N0YXJ0VGltZXJUb1JldHJpZXZlVm90ZXIsIG51bWJlck9mVm90ZXJSZXRyaWV2ZUF0dGVtcHRzOicsIG51bWJlck9mVm90ZXJSZXRyaWV2ZUF0dGVtcHRzKTtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7XG4gICAgdGhpcy50aW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgVm90ZXJBY3Rpb25zLnZvdGVyUmV0cmlldmUoKTtcbiAgICAgIG51bWJlck9mVm90ZXJSZXRyaWV2ZUF0dGVtcHRzICs9IDE7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgbnVtYmVyT2ZWb3RlclJldHJpZXZlQXR0ZW1wdHMsXG4gICAgICB9KTtcbiAgICB9LCBkZWxheUJlZm9yZVZvdGVyUmVmcmVzaENhbGwpO1xuICB9XG5cbiAgdG9nZ2xlU2VsZWN0QmFsbG90TW9kYWwgKGRlc3RpbmF0aW9uVXJsRm9ySGlzdG9yeVB1c2ggPSAnJykge1xuICAgIGNvbnN0IHsgc2hvd1NlbGVjdEJhbGxvdE1vZGFsIH0gPSB0aGlzLnN0YXRlO1xuICAgIC8vIGNvbnNvbGUubG9nKCdCYWxsb3QgdG9nZ2xlU2VsZWN0QmFsbG90TW9kYWwsIGRlc3RpbmF0aW9uVXJsRm9ySGlzdG9yeVB1c2g6JywgZGVzdGluYXRpb25VcmxGb3JIaXN0b3J5UHVzaCwgJywgc2hvd1NlbGVjdEJhbGxvdE1vZGFsOicsIHNob3dTZWxlY3RCYWxsb3RNb2RhbCk7XG4gICAgaWYgKHNob3dTZWxlY3RCYWxsb3RNb2RhbCAmJiBkZXN0aW5hdGlvblVybEZvckhpc3RvcnlQdXNoICYmIGRlc3RpbmF0aW9uVXJsRm9ySGlzdG9yeVB1c2ggIT09ICcnKSB7XG4gICAgICBoaXN0b3J5UHVzaChkZXN0aW5hdGlvblVybEZvckhpc3RvcnlQdXNoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gY29uc29sZS5sb2coJ0JhbGxvdCB0b2dnbGVTZWxlY3RCYWxsb3RNb2RhbCwgQmFsbG90QWN0aW9ucy52b3RlckJhbGxvdExpc3RSZXRyaWV2ZSgpJyk7XG4gICAgICBCYWxsb3RBY3Rpb25zLnZvdGVyQmFsbG90TGlzdFJldHJpZXZlKCk7IC8vIFJldHJpZXZlIGEgbGlzdCBvZiBiYWxsb3RzIGZvciB0aGUgdm90ZXIgZnJvbSBvdGhlciBlbGVjdGlvbnNcbiAgICB9XG5cbiAgICBBcHBBY3Rpb25zLnNldFNob3dTZWxlY3RCYWxsb3RNb2RhbCghc2hvd1NlbGVjdEJhbGxvdE1vZGFsKTtcbiAgfVxuXG4gIC8vIE5lZWRlZCB0byBzY3JvbGwgdG8gYW5jaG9yIHRhZ3MgYmFzZWQgb24gaGFzaCBpbiB1cmwgKGFzIGRvbmUgZm9yIGJvb2ttYXJrcylcbiAgaGFzaExpbmtTY3JvbGwgKCkge1xuICAgIGNvbnN0IHsgaGFzaCB9ID0gd2luZG93LmxvY2F0aW9uO1xuICAgIGlmIChoYXNoICE9PSAnJykge1xuICAgICAgLy8gUHVzaCBvbnRvIGNhbGxiYWNrIHF1ZXVlIHNvIGl0IHJ1bnMgYWZ0ZXIgdGhlIERPTSBpcyB1cGRhdGVkLFxuICAgICAgLy8gdGhpcyBpcyByZXF1aXJlZCB3aGVuIG5hdmlnYXRpbmcgZnJvbSBhIGRpZmZlcmVudCBwYWdlIHNvIHRoYXRcbiAgICAgIC8vIHRoZSBlbGVtZW50IGlzIHJlbmRlcmVkIG9uIHRoZSBwYWdlIGJlZm9yZSB0cnlpbmcgdG8gZ2V0RWxlbWVudEJ5SWQuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3QgaWQgPSBoYXNoLnJlcGxhY2UoJyMnLCAnJyk7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XG5cbiAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICBjb25zdCBwb3NpdGlvblkgPSBlbGVtZW50Lm9mZnNldFRvcDtcbiAgICAgICAgICBpZiAoaXNNb2JpbGUoKSkge1xuICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHBvc2l0aW9uWSArIDI1MCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBwb3NpdGlvblkgKyAxOTYpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgMCk7XG4gICAgfVxuICB9XG5cbiAgdG9nZ2xlRXhwYW5kQmFsbG90SXRlbURldGFpbHMgKHNlbGVjdGVkQmFsbG90SXRlbUlkKSB7XG4gICAgaWYgKHRoaXMuYmFsbG90SXRlbXNbc2VsZWN0ZWRCYWxsb3RJdGVtSWRdICYmXG4gICAgICAgIHRoaXMuYmFsbG90SXRlbXNbc2VsZWN0ZWRCYWxsb3RJdGVtSWRdLmJhbGxvdEl0ZW0gJiZcbiAgICAgICAgdGhpcy5iYWxsb3RJdGVtc1tzZWxlY3RlZEJhbGxvdEl0ZW1JZF0uYmFsbG90SXRlbS50b2dnbGVFeHBhbmREZXRhaWxzKSB7XG4gICAgICB0aGlzLmJhbGxvdEl0ZW1zW3NlbGVjdGVkQmFsbG90SXRlbUlkXS5iYWxsb3RJdGVtLnRvZ2dsZUV4cGFuZERldGFpbHModHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgYmFsbG90SXRlbUxpbmtIYXNCZWVuQ2xpY2tlZCAoc2VsZWN0ZWRCYWxsb3RJdGVtSWQpIHtcbiAgICBjb25zdCB7IGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZSwgYmFsbG90V2l0aEFsbEl0ZW1zIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGJhbGxvdEl0ZW0gPSBiYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGUuZmluZChpdGVtID0+IGl0ZW0ud2Vfdm90ZV9pZCA9PT0gc2VsZWN0ZWRCYWxsb3RJdGVtSWQpO1xuICAgIC8vIElmIHRoZSBiYWxsb3QgaXRlbSBleGlzdHMgaW4gdGhlIGFycmF5IG9mIGJhbGxvdCBpdGVtcyBmaWx0ZXJlZCBieSB0aGUgY29tcGxldGlvbiBmaWx0ZXIgdHlwZVxuICAgIGlmIChiYWxsb3RJdGVtKSB7XG4gICAgICBjb25zdCByYWNlQ2F0ZWdvcnlEaXNwbGF5VGV4dCA9IG1hcENhdGVnb3J5RmlsdGVyVHlwZShiYWxsb3RJdGVtLnJhY2Vfb2ZmaWNlX2xldmVsIHx8IGJhbGxvdEl0ZW0ua2luZF9vZl9iYWxsb3RfaXRlbSk7XG4gICAgICAvLyBjb25zb2xlLmxvZygnYmFsbG90SXRlbUxpbmtIYXNCZWVuQ2xpY2tlZCByYWNlTGV2ZWxGaWx0ZXJUeXBlIGJhbGxvdEl0ZW09VHJ1ZTonLCByYWNlQ2F0ZWdvcnlEaXNwbGF5VGV4dCk7XG4gICAgICBpZiAocmFjZUNhdGVnb3J5RGlzcGxheVRleHQpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgcmFjZUxldmVsRmlsdGVyVHlwZTogcmFjZUNhdGVnb3J5RGlzcGxheVRleHQsXG4gICAgICAgIH0sICgpID0+IHRoaXMudG9nZ2xlRXhwYW5kQmFsbG90SXRlbURldGFpbHMoc2VsZWN0ZWRCYWxsb3RJdGVtSWQpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhlIGJhbGxvdCBpdGVtIHdhcyBub3QgZm91bmQgaW4gdGhlIGFycmF5IG9mIGJhbGxvdCBpdGVtcyBmaWx0ZXJlZCBieSBjb21wbGV0aW9uIGZpbHRlciB0eXBlXG4gICAgICBjb25zdCBiYWxsb3RJdGVtRnJvbUFsbCA9IGJhbGxvdFdpdGhBbGxJdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS53ZV92b3RlX2lkID09PSBzZWxlY3RlZEJhbGxvdEl0ZW1JZCk7XG4gICAgICBjb25zdCByYWNlQ2F0ZWdvcnlEaXNwbGF5VGV4dCA9IG1hcENhdGVnb3J5RmlsdGVyVHlwZShiYWxsb3RJdGVtRnJvbUFsbC5yYWNlX29mZmljZV9sZXZlbCB8fCBiYWxsb3RJdGVtRnJvbUFsbC5raW5kX29mX2JhbGxvdF9pdGVtKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdiYWxsb3RJdGVtTGlua0hhc0JlZW5DbGlja2VkIHJhY2VMZXZlbEZpbHRlclR5cGUgYmFsbG90SXRlbT1GYWxzZTonLCByYWNlQ2F0ZWdvcnlEaXNwbGF5VGV4dCk7XG4gICAgICBCYWxsb3RBY3Rpb25zLmNvbXBsZXRpb25MZXZlbEZpbHRlclR5cGVTYXZlKCdmaWx0ZXJBbGxCYWxsb3RJdGVtcycpO1xuICAgICAgQmFsbG90QWN0aW9ucy5yYWNlTGV2ZWxGaWx0ZXJUeXBlU2F2ZShyYWNlQ2F0ZWdvcnlEaXNwbGF5VGV4dCk7XG4gICAgICBpZiAocmFjZUNhdGVnb3J5RGlzcGxheVRleHQpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgcmFjZUxldmVsRmlsdGVyVHlwZTogcmFjZUNhdGVnb3J5RGlzcGxheVRleHQsXG4gICAgICAgIH0sICgpID0+IHRoaXMudG9nZ2xlRXhwYW5kQmFsbG90SXRlbURldGFpbHMoc2VsZWN0ZWRCYWxsb3RJdGVtSWQpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBjb21wb25lbnREaWRDYXRjaCAoZXJyb3IsIGluZm8pIHtcbiAgLy8gICAvLyBXZSBzaG91bGQgZ2V0IHRoaXMgaW5mb3JtYXRpb24gdG8gU3BsdW5rIVxuICAvLyAgIGNvbnNvbGUuZXJyb3IoJ0JhbGxvdCBjYXVnaHQgZXJyb3I6ICcsIGAke2Vycm9yfSB3aXRoIGluZm86IGAsIGluZm8pO1xuICAvLyB9XG5cbiAgdXBkYXRlT2ZmaWNlRGlzcGxheVVuZnVybGVkVHJhY2tlciAod2VWb3RlSWQsIHN0YXR1cykge1xuICAgIGNvbnN0IHsgYmFsbG90SXRlbVVuZnVybGVkVHJhY2tlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBuZXdCYWxsb3RJdGVtVW5mdXJsZWRUcmFja2VyID0geyAuLi5iYWxsb3RJdGVtVW5mdXJsZWRUcmFja2VyLCBbd2VWb3RlSWRdOiBzdGF0dXMgfTtcbiAgICBCYWxsb3RBY3Rpb25zLnZvdGVyQmFsbG90SXRlbU9wZW5PckNsb3NlZFNhdmUobmV3QmFsbG90SXRlbVVuZnVybGVkVHJhY2tlcik7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBiYWxsb3RJdGVtVW5mdXJsZWRUcmFja2VyOiBuZXdCYWxsb3RJdGVtVW5mdXJsZWRUcmFja2VyLFxuICAgIH0pO1xuICB9XG5cbiAgcmVuZGVyICgpIHtcbiAgICByZW5kZXJMb2coJ0JhbGxvdCcpOyAgLy8gU2V0IExPR19SRU5ERVJfRVZFTlRTIHRvIGxvZyBhbGwgcmVuZGVyc1xuICAgIGNvbnN0IGJhbGxvdEJhc2VVcmwgPSAnL2JhbGxvdCc7XG4gICAgY29uc3QgeyBjbGFzc2VzIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHtcbiAgICAgIGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZSwgc2hvd0ZpbHRlclRhYnMsIGRvdWJsZUZpbHRlcmVkQmFsbG90SXRlbXNMZW5ndGgsIGNvbXBsZXRpb25MZXZlbEZpbHRlclR5cGUsXG4gICAgICBiYWxsb3RIZWFkZXJVbnBpbm5lZCwgaXNTZWFyY2hpbmcsIGJhbGxvdFdpdGhBbGxJdGVtcywgYmFsbG90U2VhcmNoUmVzdWx0cywgcmFjZUxldmVsRmlsdGVySXRlbXNJblRoaXNCYWxsb3QsXG4gICAgfSA9IHRoaXMuc3RhdGU7XG4gICAgbGV0IHsgcmFjZUxldmVsRmlsdGVyVHlwZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBpZiAoIXJhY2VMZXZlbEZpbHRlclR5cGUpIHtcbiAgICAgIHJhY2VMZXZlbEZpbHRlclR5cGUgPSAnJzsgLy8gTWFrZSBzdXJlIHRoaXMgaXMgYSBzdHJpbmdcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2coYmFsbG90V2l0aEFsbEl0ZW1zKTtcbiAgICBjb25zdCB0ZXh0Rm9yTWFwU2VhcmNoID0gVm90ZXJTdG9yZS5nZXRUZXh0Rm9yTWFwU2VhcmNoKCk7XG5cbiAgICBpZiAoIWJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZSkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJiYWxsb3QgY29udGFpbmVyLWZsdWlkIHdlbGwgdS1zdGFjay0tbWQgdS1pbnNldC0tbWRcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImJhbGxvdF9faGVhZGVyXCIgc3R5bGU9e3sgbWFyZ2luVG9wOiBgJHtpc0NvcmRvdmEoKSA/ICcxMDBweCcgOiAndW5kZWZpbmVkJ31gIH19PlxuICAgICAgICAgICAgPGRpdiBzdHlsZT17eyB0ZXh0QWxpZ246ICdjZW50ZXInIH19PlxuICAgICAgICAgICAgICBJZiB5b3VyIGJhbGxvdCBkb2VzIG5vdCBhcHBlYXIgbW9tZW50YXJpbHksXG4gICAgICAgICAgICAgIHsnICd9XG4gICAgICAgICAgICAgIHsvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUganN4LWExMXkvYW5jaG9yLWlzLXZhbGlkICovfVxuICAgICAgICAgICAgICA8TGlua1xuICAgICAgICAgICAgICAgIC8vIHNpbmNlIHdlIHVzZSBhIGJ1dHRvbiBhcyB0aGUgY29tcG9uZW50LCB3ZSBjYW4gZGlzYWJsZSB0aGF0IGVzLWxpbnQgcnVsZVxuICAgICAgICAgICAgICAgIGNvbXBvbmVudD1cImJ1dHRvblwiXG4gICAgICAgICAgICAgICAgaWQ9XCJiYWxsb3RJZkJhbGxvdERvZXNOb3RBcHBlYXJcIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMudG9nZ2xlU2VsZWN0QmFsbG90TW9kYWx9XG4gICAgICAgICAgICAgICAgc3R5bGU9e3sgY29sb3I6ICdyZ2IoNiwgOTUsIDIxMiknIH19XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICBwbGVhc2UgY2xpY2sgaGVyZSB0byBjaGFuZ2UgeW91ciBhZGRyZXNzLlxuICAgICAgICAgICAgICA8L0xpbms+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHZvdGVyQWRkcmVzc01pc3NpbmcgPSB0aGlzLnN0YXRlLmxvY2F0aW9uID09PSBudWxsO1xuXG4gICAgLy8gY29uc3QgYmFsbG90X2NhdmVhdCA9IEJhbGxvdFN0b3JlLmJhbGxvdFByb3BlcnRpZXMuYmFsbG90X2NhdmVhdDsgLy8gYmFsbG90UHJvcGVydGllcyBtaWdodCBiZSB1bmRlZmluZWRcbiAgICBjb25zdCBlbGVjdGlvbk5hbWUgPSBCYWxsb3RTdG9yZS5jdXJyZW50QmFsbG90RWxlY3Rpb25OYW1lIHx8ICcnO1xuICAgIGNvbnN0IGVsZWN0aW9uRGF5VGV4dCA9IEJhbGxvdFN0b3JlLmN1cnJlbnRCYWxsb3RFbGVjdGlvbkRhdGU7XG4gICAgY29uc3Qgc291cmNlUG9sbGluZ0xvY2F0aW9uV2VWb3RlSWQgPSBCYWxsb3RTdG9yZS5jdXJyZW50QmFsbG90UG9sbGluZ0xvY2F0aW9uU291cmNlO1xuICAgIGNvbnN0IGJhbGxvdFJldHVybmVkQWRtaW5FZGl0VXJsID0gYCR7d2ViQXBwQ29uZmlnLldFX1ZPVEVfU0VSVkVSX1JPT1RfVVJMfWIvJHtzb3VyY2VQb2xsaW5nTG9jYXRpb25XZVZvdGVJZH0vbGlzdF9lZGl0X2J5X3BvbGxpbmdfbG9jYXRpb24vP2dvb2dsZV9jaXZpY19lbGVjdGlvbl9pZD0ke1ZvdGVyU3RvcmUuZWxlY3Rpb25JZCgpfSZzdGF0ZV9jb2RlPWA7XG4gICAgLy8gY29uc29sZS5sb2coJ2VsZWN0aW9uTmFtZTogJywgZWxlY3Rpb25OYW1lLCAnLCBlbGVjdGlvbkRheVRleHQ6ICcsIGVsZWN0aW9uRGF5VGV4dCk7XG5cbiAgICBjb25zdCBlbXB0eUJhbGxvdEJ1dHRvbiA9IGNvbXBsZXRpb25MZXZlbEZpbHRlclR5cGUgIT09ICdub25lJyAmJiAhdm90ZXJBZGRyZXNzTWlzc2luZyA/IChcbiAgICAgIDxzcGFuPlxuICAgICAgICB7LyogPExpbmsgdG89e2JhbGxvdEJhc2VVcmx9PlxuICAgICAgICAgIDxCdXR0b24gdmFyaWFudD1cInByaW1hcnlcIj5WaWV3IEZ1bGwgQmFsbG90PC9CdXR0b24+XG4gICAgICAgIDwvTGluaz4gKi99XG4gICAgICA8L3NwYW4+XG4gICAgKSA6IChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY29udGFpbmVyLWZsdWlkIHdlbGwgdS1zdGFjay0tbWQgdS1pbnNldC0tbWRcIj5cbiAgICAgICAgPEhlbG1ldCB0aXRsZT1cIkVudGVyIFlvdXIgQWRkcmVzcyAtIFdlIFZvdGVcIiAvPlxuICAgICAgICA8aDMgY2xhc3NOYW1lPVwiaDNcIj5cbiAgICAgICAgICBFbnRlciBhZGRyZXNzIHdoZXJlIHlvdSBhcmUgcmVnaXN0ZXJlZCB0byB2b3RlXG4gICAgICAgIDwvaDM+XG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPEFkZHJlc3NCb3ggey4uLnRoaXMucHJvcHN9IHNhdmVVcmw9e2JhbGxvdEJhc2VVcmx9IC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcblxuICAgIC8vIGNvbnNvbGUubG9nKCdiYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGUubGVuZ3RoOiAnLCBiYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGUubGVuZ3RoKTtcbiAgICAvLyBXYXM6IGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZVxuICAgIGNvbnN0IGVtcHR5QmFsbG90ID0gYmFsbG90V2l0aEFsbEl0ZW1zLmxlbmd0aCA9PT0gMCA/IChcbiAgICAgIDxkaXY+XG4gICAgICAgIDxoMyBjbGFzc05hbWU9XCJ0ZXh0LWNlbnRlclwiPnt0aGlzLmdldEVtcHR5TWVzc2FnZUJ5RmlsdGVyVHlwZShjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlKX08L2gzPlxuICAgICAgICB7ZW1wdHlCYWxsb3RCdXR0b259XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY29udGFpbmVyLWZsdWlkIHdlbGwgdS1zdGFjay0tbWQgdS1pbnNldC0tbWRcIj5cbiAgICAgICAgICA8QmFsbG90RWxlY3Rpb25MaXN0V2l0aEZpbHRlcnNcbiAgICAgICAgICAgIGJhbGxvdEJhc2VVcmw9e2JhbGxvdEJhc2VVcmx9XG4gICAgICAgICAgICBiYWxsb3RFbGVjdGlvbkxpc3Q9e3RoaXMuc3RhdGUudm90ZXJCYWxsb3RMaXN0fVxuICAgICAgICAgIC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKSA6IG51bGw7XG5cbiAgICBjb25zdCBlbGVjdGlvbkRheVRleHRGb3JtYXR0ZWQgPSBlbGVjdGlvbkRheVRleHQgPyBtb21lbnQoZWxlY3Rpb25EYXlUZXh0KS5mb3JtYXQoJ01NTSBEbywgWVlZWScpIDogJyc7XG4gICAgLy8gY29uc29sZS5sb2coJ2VsZWN0aW9uTmFtZTogJywgZWxlY3Rpb25OYW1lLCAnLCBlbGVjdGlvbkRheVRleHRGb3JtYXR0ZWQ6ICcsIGVsZWN0aW9uRGF5VGV4dEZvcm1hdHRlZCk7XG5cbiAgICBjb25zdCBpblJlbWFpbmluZ0RlY2lzaW9uc01vZGUgPSBjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlID09PSAnZmlsdGVyUmVtYWluaW5nJztcblxuICAgIGlmIChiYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGUubGVuZ3RoID09PSAwICYmIGluUmVtYWluaW5nRGVjaXNpb25zTW9kZSkge1xuICAgICAgaGlzdG9yeVB1c2godGhpcy5zdGF0ZS5wYXRobmFtZSk7XG4gICAgfVxuXG4gICAgY29uc3Qgc2hvd0JhbGxvdERlY2lzaW9uVGFicyA9IChCYWxsb3RTdG9yZS5iYWxsb3RMZW5ndGggIT09IEJhbGxvdFN0b3JlLmJhbGxvdFJlbWFpbmluZ0Nob2ljZXNMZW5ndGgpICYmXG4gICAgICAoQmFsbG90U3RvcmUuYmFsbG90UmVtYWluaW5nQ2hvaWNlc0xlbmd0aCA+IDApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYmFsbG90X3Jvb3RcIj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2BiYWxsb3RfX2hlYWRpbmcgJHtiYWxsb3RIZWFkZXJVbnBpbm5lZCAmJiBpc1dlYkFwcCgpID8gJ2JhbGxvdF9faGVhZGluZ19fdW5waW5uZWQnIDogJyd9YH0+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJwYWdlLWNvbnRlbnQtY29udGFpbmVyXCIgc3R5bGU9e3sgbWFyZ2luVG9wOiBgJHtjb3Jkb3ZhQmFsbG90RmlsdGVyVG9wTWFyZ2luKCl9YCB9fT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY29udGFpbmVyLWZsdWlkXCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicm93XCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjb2wtbWQtMTJcIj5cbiAgICAgICAgICAgICAgICAgIDxIZWxtZXQgdGl0bGU9XCJCYWxsb3QgLSBXZSBWb3RlXCIgLz5cbiAgICAgICAgICAgICAgICAgIDxoZWFkZXIgY2xhc3NOYW1lPVwiYmFsbG90X19oZWFkZXJfX2dyb3VwXCI+XG4gICAgICAgICAgICAgICAgICAgIDxCYWxsb3RUaXRsZUhlYWRlciBlbGVjdGlvbk5hbWU9e2VsZWN0aW9uTmFtZX0gZWxlY3Rpb25EYXlUZXh0Rm9ybWF0dGVkPXtlbGVjdGlvbkRheVRleHRGb3JtYXR0ZWR9IC8+XG4gICAgICAgICAgICAgICAgICA8L2hlYWRlcj5cblxuICAgICAgICAgICAgICAgICAgeyB0ZXh0Rm9yTWFwU2VhcmNoIHx8IGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZS5sZW5ndGggPiAwID8gKFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImJhbGxvdF9fZmlsdGVyX19jb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICB7IHNob3dCYWxsb3REZWNpc2lvblRhYnMgPyAoXG4gICAgICAgICAgICAgICAgICAgICAgICA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYmFsbG90X19maWx0ZXIgZC1wcmludC1ub25lXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJhbGxvdERlY2lzaW9uc1RhYnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRpb25MZXZlbEZpbHRlclR5cGU9e0JhbGxvdFN0b3JlLmNsZWFuQ29tcGxldGlvbkxldmVsRmlsdGVyVHlwZShjb21wbGV0aW9uTGV2ZWxGaWx0ZXJUeXBlKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbGxvdExlbmd0aD17QmFsbG90U3RvcmUuYmFsbG90TGVuZ3RofVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFsbG90TGVuZ3RoUmVtYWluaW5nPXtCYWxsb3RTdG9yZS5iYWxsb3RSZW1haW5pbmdDaG9pY2VzTGVuZ3RofVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8aHIgY2xhc3NOYW1lPVwiYmFsbG90LWhlYWRlci1kaXZpZGVyXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvUmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgICAgICAgICAgICAgKSA6IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgICAgICAgICA8QmFsbG90RmlsdGVyUm93IHNob3dGaWx0ZXJUYWJzPXtzaG93RmlsdGVyVGFic30+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImJhbGxvdF9faXRlbS1maWx0ZXItdGFic1wiIHJlZj17KGNoaXBzKSA9PiB7IHRoaXMuY2hpcENvbnRhaW5lciA9IGNoaXBzOyB9fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgeyBiYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGUubGVuZ3RoID8gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCYWxsb3RTZWFyY2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNTZWFyY2hpbmc9e2lzU2VhcmNoaW5nfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblRvZ2dsZVNlYXJjaD17dGhpcy5oYW5kbGVUb2dnbGVTZWFyY2hCYWxsb3R9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zPXtiYWxsb3RXaXRoQWxsSXRlbXN9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQmFsbG90U2VhcmNoPXt0aGlzLm9uQmFsbG90U2VhcmNofVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHdheXNPcGVuPXshc2hvd0ZpbHRlclRhYnN9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBzaG93RmlsdGVyVGFicyA/IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQkFMTE9UX0lURU1fRklMVEVSX1RZUEVTLm1hcCgob25lVHlwZU9mQmFsbG90SXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFsbEJhbGxvdEl0ZW1zQnlGaWx0ZXJUeXBlID0gdGhpcy5zdGF0ZS5iYWxsb3RXaXRoQWxsSXRlbXMuZmlsdGVyKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob25lVHlwZU9mQmFsbG90SXRlbSA9PT0gJ01lYXN1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmtpbmRfb2ZfYmFsbG90X2l0ZW0gPT09ICdNRUFTVVJFJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvbmVUeXBlT2ZCYWxsb3RJdGVtID09PSBpdGVtLnJhY2Vfb2ZmaWNlX2xldmVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbGxCYWxsb3RJdGVtc0J5RmlsdGVyVHlwZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhbGxvdEl0ZW1zQnlGaWx0ZXJUeXBlID0gYmFsbG90V2l0aEl0ZW1zRnJvbUNvbXBsZXRpb25GaWx0ZXJUeXBlLmZpbHRlcigoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob25lVHlwZU9mQmFsbG90SXRlbSA9PT0gJ01lYXN1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ua2luZF9vZl9iYWxsb3RfaXRlbSA9PT0gJ01FQVNVUkUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvbmVUeXBlT2ZCYWxsb3RJdGVtID09PSBpdGVtLnJhY2Vfb2ZmaWNlX2xldmVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYmFsbG90X2ZpbHRlcl9idG5zXCIga2V5PXtvbmVUeXBlT2ZCYWxsb3RJdGVtfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QmFkZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhZGdlQ29udGVudD17YmFsbG90SXRlbXNCeUZpbHRlclR5cGUubGVuZ3RofVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3Nlcz17eyBiYWRnZTogY2xhc3Nlcy5iYWRnZSwgY29sb3JQcmltYXJ5OiBjbGFzc2VzLmJhZGdlQ29sb3JQcmltYXJ5IH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj17KG9uZVR5cGVPZkJhbGxvdEl0ZW0gPT09IHJhY2VMZXZlbEZpbHRlclR5cGUgJiYgIWlzU2VhcmNoaW5nKSA/ICdwcmltYXJ5JyA6ICdkZWZhdWx0J31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkPXtgYmFsbG90QmFkZ2UtJHtvbmVUeXBlT2ZCYWxsb3RJdGVtfWB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZpc2libGU9e2JhbGxvdEl0ZW1zQnlGaWx0ZXJUeXBlLmxlbmd0aCA9PT0gMH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRoaXMuc2V0QmFsbG90SXRlbUZpbHRlclR5cGUob25lVHlwZU9mQmFsbG90SXRlbSwgYmFsbG90SXRlbXNCeUZpbHRlclR5cGUubGVuZ3RoKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Q2hpcCB2YXJpYW50PVwib3V0bGluZWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj17KG9uZVR5cGVPZkJhbGxvdEl0ZW0gPT09IHJhY2VMZXZlbEZpbHRlclR5cGUgJiYgIWlzU2VhcmNoaW5nKSA/ICdwcmltYXJ5JyA6ICdkZWZhdWx0J31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdGhpcy5zZXRCYWxsb3RJdGVtRmlsdGVyVHlwZShvbmVUeXBlT2ZCYWxsb3RJdGVtLCBiYWxsb3RJdGVtc0J5RmlsdGVyVHlwZS5sZW5ndGgpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJidG5fYmFsbG90X2ZpbHRlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzZXM9e3sgcm9vdDogY2xhc3Nlcy5jaGlwUm9vdCwgbGFiZWw6IGNsYXNzZXMuY2hpcExhYmVsLCBvdXRsaW5lZFByaW1hcnk6IChvbmVUeXBlT2ZCYWxsb3RJdGVtID09PSByYWNlTGV2ZWxGaWx0ZXJUeXBlICYmICFpc1NlYXJjaGluZykgPyBjbGFzc2VzLmNoaXBPdXRsaW5lZCA6IG51bGwgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e29uZVR5cGVPZkJhbGxvdEl0ZW19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQmFkZ2U+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9SZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgPC9CYWxsb3RGaWx0ZXJSb3c+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgKSA6IG51bGxcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJwYWdlLWNvbnRlbnQtY29udGFpbmVyXCI+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjb250YWluZXItZmx1aWRcIj5cbiAgICAgICAgICAgIDxXcmFwcGVyIHBhZFRvcD17Y29yZG92YVNjcm9sbGFibGVQYW5lVG9wUGFkZGluZygpfT5cbiAgICAgICAgICAgICAge2VtcHR5QmFsbG90fVxuICAgICAgICAgICAgICB7LyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW5lc3RlZC10ZXJuYXJ5ICovfVxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c2hvd0JhbGxvdERlY2lzaW9uVGFicyA/ICdyb3cgYmFsbG90X19ib2R5JyA6IGlzV2ViQXBwKCkgPyAncm93IGJhbGxvdF9fYm9keV9fbm8tZGVjaXNpb24tdGFicycgOiB1bmRlZmluZWR9PlxuICAgICAgICAgICAgICAgIDxCcm93c2VyUHVzaE1lc3NhZ2UgaW5jb21pbmdQcm9wcz17dGhpcy5wcm9wc30gLz5cbiAgICAgICAgICAgICAgICB7YmFsbG90V2l0aEl0ZW1zRnJvbUNvbXBsZXRpb25GaWx0ZXJUeXBlLmxlbmd0aCA+IDAgPyAoXG4gICAgICAgICAgICAgICAgICA8QmFsbG90U3RhdHVzTWVzc2FnZVxuICAgICAgICAgICAgICAgICAgICBiYWxsb3RMb2NhdGlvbkNob3NlblxuICAgICAgICAgICAgICAgICAgICBnb29nbGVDaXZpY0VsZWN0aW9uSWQ9e3RoaXMuc3RhdGUuZ29vZ2xlQ2l2aWNFbGVjdGlvbklkfVxuICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICApIDogbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbC1zbS0xMiBjb2wtbGctOVwiPlxuICAgICAgICAgICAgICAgICAgPExvY2F0aW9uR3Vlc3NcbiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlU2VsZWN0QmFsbG90TW9kYWw9e3RoaXMudG9nZ2xlU2VsZWN0QmFsbG90TW9kYWx9XG4gICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgey8qIFRoZSByZXN0IG9mIHRoZSBiYWxsb3QgaXRlbXMgKi99XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtpc1dlYkFwcCgpID8gJ0JhbGxvdExpc3QnIDogJ0JhbGxvdExpc3RfX2NvcmRvdmEnfT5cbiAgICAgICAgICAgICAgICAgICAgICB7KGlzU2VhcmNoaW5nICYmIGJhbGxvdFNlYXJjaFJlc3VsdHMubGVuZ3RoID8gYmFsbG90U2VhcmNoUmVzdWx0cyA6IGJhbGxvdFdpdGhJdGVtc0Zyb21Db21wbGV0aW9uRmlsdGVyVHlwZSkubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBCYWxsb3QgbGltaXRlZCBieSBpdGVtcyBieSByYWNlX29mZmljZV9sZXZlbCA9IChGZWRlcmFsLCBTdGF0ZSwgTG9jYWwpIG9yIGtpbmRfb2ZfYmFsbG90X2l0ZW0gPSAoTWVhc3VyZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocmFjZUxldmVsRmlsdGVyVHlwZSA9PT0gJ0FsbCcgfHwgKGlzU2VhcmNoaW5nICYmIGJhbGxvdFNlYXJjaFJlc3VsdHMubGVuZ3RoKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAoaXRlbS5raW5kX29mX2JhbGxvdF9pdGVtID09PSByYWNlTGV2ZWxGaWx0ZXJUeXBlLnRvVXBwZXJDYXNlKCkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJhY2VMZXZlbEZpbHRlclR5cGUgPT09IGl0ZW0ucmFjZV9vZmZpY2VfbGV2ZWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdCYWxsb3QgaXRlbSBmb3IgQmFsbG90SXRlbUNvbXByZXNzZWQ6JywgaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHsuLi5pdGVtfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBpdGVtLndlX3ZvdGVfaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJhbGxvdEl0ZW1Db21wcmVzc2VkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9e2tleX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzTWVhc3VyZT17aXRlbS5raW5kX29mX2JhbGxvdF9pdGVtID09PSBUWVBFUy5NRUFTVVJFfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFsbG90SXRlbURpc3BsYXlOYW1lPXtpdGVtLmJhbGxvdF9pdGVtX2Rpc3BsYXlfbmFtZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZUxpc3Q9e2l0ZW0uY2FuZGlkYXRlX2xpc3R9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZVZvdGVJZD17aXRlbS53ZV92b3RlX2lkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB7ZG91YmxlRmlsdGVyZWRCYWxsb3RJdGVtc0xlbmd0aCA9PT0gMCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93VXNlckVtcHR5T3B0aW9ucygpXG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIDxCYWxsb3RTdW1tYXJ5Rm9vdGVyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVSYWNlSXRlbT17cmFjZUxldmVsRmlsdGVyVHlwZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlUaXRsZVxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVN1YnRpdGxlc1xuICAgICAgICAgICAgICAgICAgICAgICAgcmF3VXJsVmFyaWFibGVzU3RyaW5nPXt0aGlzLnByb3BzLmxvY2F0aW9uLnNlYXJjaH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJhbGxvdFdpdGhBbGxJdGVtc0J5RmlsdGVyVHlwZT17dGhpcy5zdGF0ZS5iYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGV9XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWxsb3RJdGVtTGlua0hhc0JlZW5DbGlja2VkPXt0aGlzLmJhbGxvdEl0ZW1MaW5rSGFzQmVlbkNsaWNrZWR9XG4gICAgICAgICAgICAgICAgICAgICAgICByYWNlTGV2ZWxGaWx0ZXJJdGVtc0luVGhpc0JhbGxvdD17cmFjZUxldmVsRmlsdGVySXRlbXNJblRoaXNCYWxsb3R9XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRBY3RpdmVSYWNlSXRlbT17dHlwZSA9PiB0aGlzLnNldFJhY2VMZXZlbEZpbHRlclR5cGUodHlwZSl9XG4gICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgIHsvKiBTaG93IGxpbmtzIHRvIHRoaXMgY2FuZGlkYXRlIGluIHRoZSBhZG1pbiB0b29scyAqL31cbiAgICAgICAgICAgICAgICAgIHsgKHRoaXMuc3RhdGUudm90ZXIgJiYgc291cmNlUG9sbGluZ0xvY2F0aW9uV2VWb3RlSWQpICYmICh0aGlzLnN0YXRlLnZvdGVyLmlzX2FkbWluIHx8IHRoaXMuc3RhdGUudm90ZXIuaXNfdmVyaWZpZWRfdm9sdW50ZWVyKSA/IChcbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwidS13cmFwLWxpbmtzIGQtcHJpbnQtbm9uZVwiPlxuICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPkFkbWluOjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICA8T3BlbkV4dGVybmFsV2ViU2l0ZVxuICAgICAgICAgICAgICAgICAgICAgIHVybD17YmFsbG90UmV0dXJuZWRBZG1pbkVkaXRVcmx9XG4gICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0PVwiX2JsYW5rXCJcbiAgICAgICAgICAgICAgICAgICAgICBib2R5PXsoXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgQmFsbG90IGNvcGllZCBmcm9tIHBvbGxpbmcgbG9jYXRpb24gJnF1b3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHtzb3VyY2VQb2xsaW5nTG9jYXRpb25XZVZvdGVJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgJnF1b3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICApIDogbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgIHsgYmFsbG90V2l0aEl0ZW1zRnJvbUNvbXBsZXRpb25GaWx0ZXJUeXBlLmxlbmd0aCA9PT0gMCB8fCBpc0NvcmRvdmEoKSA/XG4gICAgICAgICAgICAgICAgICBudWxsIDogKFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbC1sZy0zIGQtbm9uZSBkLWxnLWJsb2NrIHNpZGViYXItbWVudVwiPlxuICAgICAgICAgICAgICAgICAgICAgIDxCYWxsb3RTaWRlQmFyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVSYWNlSXRlbT17cmFjZUxldmVsRmlsdGVyVHlwZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlUaXRsZVxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVN1YnRpdGxlc1xuICAgICAgICAgICAgICAgICAgICAgICAgcmF3VXJsVmFyaWFibGVzU3RyaW5nPXt0aGlzLnByb3BzLmxvY2F0aW9uLnNlYXJjaH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJhbGxvdFdpdGhBbGxJdGVtc0J5RmlsdGVyVHlwZT17dGhpcy5zdGF0ZS5iYWxsb3RXaXRoSXRlbXNGcm9tQ29tcGxldGlvbkZpbHRlclR5cGV9XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWxsb3RJdGVtTGlua0hhc0JlZW5DbGlja2VkPXt0aGlzLmJhbGxvdEl0ZW1MaW5rSGFzQmVlbkNsaWNrZWR9XG4gICAgICAgICAgICAgICAgICAgICAgICByYWNlTGV2ZWxGaWx0ZXJJdGVtc0luVGhpc0JhbGxvdD17cmFjZUxldmVsRmlsdGVySXRlbXNJblRoaXNCYWxsb3R9XG4gICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvV3JhcHBlcj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG5cbmNvbnN0IFdyYXBwZXIgPSBzdHlsZWQuZGl2YFxuICBwYWRkaW5nLXRvcDogJHsoeyBwYWRUb3AgfSkgPT4gcGFkVG9wfTtcbmA7XG5cbi8vIElmIHdlIHdhbnQgdG8gdHVybiBvZmYgZmlsdGVyIHRhYnMgbmF2aWdhdGlvbiBiYXI6ICAkeyh7IHNob3dGaWx0ZXJUYWJzIH0pID0+ICFzaG93RmlsdGVyVGFicyAmJiAnaGVpZ2h0OiAwOyd9XG5jb25zdCBCYWxsb3RGaWx0ZXJSb3cgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiBmbGV4O1xuYDtcblxuY29uc3Qgc3R5bGVzID0gdGhlbWUgPT4gKHtcbiAgYmFkZ2U6IHtcbiAgICB0b3A6IDEzLFxuICAgIG1pbldpZHRoOiAxNixcbiAgICB3aWR0aDogMjAsXG4gICAgcmlnaHQ6IDE0LFxuICAgIGJhY2tncm91bmQ6ICdyZ2JhKDQ2LCA2MCwgOTMsIDAuMDgpJyxcbiAgICBjb2xvcjogJyMzMzMnLFxuICAgIGN1cnNvcjogJ3BvaW50ZXInLFxuICAgIFt0aGVtZS5icmVha3BvaW50cy5kb3duKCdtZCcpXToge1xuICAgICAgZm9udFNpemU6IDksXG4gICAgICB3aWR0aDogMTYsXG4gICAgICBoZWlnaHQ6IDE2LFxuICAgICAgdG9wOiAxMSxcbiAgICAgIHJpZ2h0OiAxMSxcbiAgICB9LFxuICB9LFxuICBiYWRnZUNvbG9yUHJpbWFyeToge1xuICAgIGJhY2tncm91bmQ6ICd3aGl0ZScsXG4gICAgY29sb3I6IHRoZW1lLnBhbGV0dGUucHJpbWFyeS5tYWluLFxuICAgICdAbWVkaWEgcHJpbnQnOiB7XG4gICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS5wcmltYXJ5Lm1haW4sXG4gICAgfSxcbiAgfSxcbiAgdW5zZWxlY3RlZEJhZGdlQ29sb3JQcmltYXJ5OiB7XG4gICAgYmFja2dyb3VuZDogJ3JnYmEoMCwgMCwgMCwgLjIpJyxcbiAgICBjb2xvcjogJyMzMzMnLFxuICB9LFxuICBjaGlwUm9vdDoge1xuICAgIGhlaWdodDogMjYsXG4gICAgW3RoZW1lLmJyZWFrcG9pbnRzLmRvd24oJ21kJyldOiB7XG4gICAgICBoZWlnaHQ6IDIyLjUsXG4gICAgfSxcbiAgfSxcbiAgY2hpcE91dGxpbmVkOiB7XG4gICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5wcmltYXJ5Lm1haW4sXG4gICAgY29sb3I6ICd3aGl0ZScsXG4gICAgJyY6aG92ZXInOiB7XG4gICAgICBiYWNrZ3JvdW5kOiBgJHt0aGVtZS5wYWxldHRlLnByaW1hcnkubGlnaHR9ICFpbXBvcnRhbnRgLFxuICAgIH0sXG4gICAgJyY6YWN0aXZlJzoge1xuICAgICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5wcmltYXJ5Lm1haW4sXG4gICAgfSxcbiAgICAnJjpmb2N1cyc6IHtcbiAgICAgIGJhY2tncm91bmQ6IGAke3RoZW1lLnBhbGV0dGUucHJpbWFyeS5tYWlufSAhaW1wb3J0YW50YCxcbiAgICB9LFxuICB9LFxuICBjaGlwTGFiZWw6IHtcbiAgICBmb250U2l6ZTogMTMsXG4gICAgcGFkZGluZ0xlZnQ6IDAsXG4gICAgW3RoZW1lLmJyZWFrcG9pbnRzLnVwKCdtZCcpXToge1xuICAgICAgZm9udFNpemU6IDE0LFxuICAgIH0sXG4gIH0sXG4gIGljb25Sb290OiB7XG4gICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgbGVmdDogMyxcbiAgICB0b3A6IDEsXG4gICAgY29sb3I6IHRoZW1lLnBhbGV0dGUucHJpbWFyeS5tYWluLFxuICAgIGN1cnNvcjogJ3BvaW50ZXInLFxuICAgIFt0aGVtZS5icmVha3BvaW50cy5kb3duKCdtZCcpXToge1xuICAgICAgZm9udFNpemU6IDE2LFxuICAgICAgdG9wOiAzLFxuICAgIH0sXG4gIH0sXG59KTtcblxuZXhwb3J0IGRlZmF1bHQgd2l0aFN0eWxlcyhzdHlsZXMpKEJhbGxvdCk7XG4iXX0=*/